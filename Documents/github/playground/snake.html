<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAKE ULTRA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0f;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Press Start 2P', monospace;
            overflow: hidden;
        }
        
        .container {
            position: relative;
        }
        
        h1 {
            color: #0ff;
            text-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 40px #0ff;
            margin-bottom: 20px;
            font-size: 28px;
            text-align: center;
            animation: flicker 2s infinite;
        }
        
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.8; }
            94% { opacity: 1; }
            96% { opacity: 0.9; }
            97% { opacity: 1; }
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #f0f;
            font-size: 12px;
        }
        
        .score-box, .highscore-box, .combo-box {
            text-shadow: 0 0 5px currentColor;
        }
        
        .power-indicator {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            height: 30px;
            align-items: center;
        }
        
        .power {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 10px;
            display: none;
            animation: pulse 0.5s infinite;
        }
        
        .power.active {
            display: block;
        }
        
        .power.invincible { background: #00f; color: #fff; }
        .power.x2 { background: #ff0; color: #000; }
        .power.slow { background: #f00; color: #fff; }
        .power.short { background: #90f; color: #fff; }
        .power.inverted { background: #f0f; color: #fff; }
        .power.ghost { background: #0f0; color: #000; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        canvas {
            border: 3px solid #0ff;
            box-shadow: 0 0 20px #0ff, inset 0 0 20px rgba(0,255,255,0.1);
            background: linear-gradient(180deg, #0a0a1a 0%, #1a0a2a 100%);
        }
        
        .event-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #f0f;
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            text-shadow: 0 0 10px #f0f;
            z-index: 10;
        }
        
        .event-display.show {
            opacity: 1;
            animation: eventPop 0.5s ease-out;
        }
        
        @keyframes eventPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .message {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: #ff0;
            font-size: 10px;
            text-shadow: 0 0 5px #ff0;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .message.show {
            opacity: 1;
        }
        
        .achievement {
            position: fixed;
            top: 20px;
            right: -300px;
            background: linear-gradient(90deg, transparent, #0f0, transparent);
            color: #fff;
            padding: 15px 20px;
            border-radius: 5px;
            font-size: 10px;
            transition: right 0.5s;
            z-index: 100;
        }
        
        .achievement.show {
            right: 20px;
        }
        
        .controls {
            margin-top: 20px;
            color: #666;
            font-size: 8px;
            text-align: center;
        }
        
        .shake {
            animation: shake 0.3s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .void-approaching {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            box-shadow: inset 0 0 100px #000;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 50;
        }
        
        .void-approaching.active {
            opacity: 1;
            animation: voidPulse 2s infinite;
        }
        
        @keyframes voidPulse {
            0%, 100% { box-shadow: inset 0 0 50px #000; }
            50% { box-shadow: inset 0 0 150px #000; }
        }
        
        .eye {
            position: absolute;
            width: 60px;
            height: 60px;
            pointer-events: none;
            display: none;
            z-index: 20;
        }
        
        .eye.show {
            display: block;
            animation: eyeFollow 2s infinite;
        }
        
        @keyframes eyeFollow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .secret-panel {
            position: fixed;
            bottom: 10px;
            left: 10px;
            color: #333;
            font-size: 8px;
        }
        
        .rainbow-mode canvas {
            animation: rainbowBorder 0.5s linear infinite;
        }
        
        @keyframes rainbowBorder {
            0% { border-color: #f00; box-shadow: 0 0 20px #f00; }
            16% { border-color: #ff0; box-shadow: 0 0 20px #ff0; }
            33% { border-color: #0f0; box-shadow: 0 0 20px #0f0; }
            50% { border-color: #0ff; box-shadow: 0 0 20px #0ff; }
            66% { border-color: #00f; box-shadow: 0 0 20px #00f; }
            83% { border-color: #f0f; box-shadow: 0 0 20px #f0f; }
            100% { border-color: #f00; box-shadow: 0 0 20px #f00; }
        }
        
        .god-mode canvas {
            border-width: 5px;
            border-color: #fff;
            box-shadow: 0 0 50px #fff, 0 0 100px #fff;
        }
        
        .lives-display {
            position: absolute;
            top: -30px;
            left: 0;
            color: #f00;
            font-size: 10px;
        }
        
        .boss-bar {
            position: absolute;
            top: -20px;
            left: 0;
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            display: none;
        }
        
        .boss-bar.show {
            display: block;
        }
        
        .boss-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #f00, #ff0);
            transition: width 0.3s;
        }
        
        .boss-name {
            position: absolute;
            top: -45px;
            left: 0;
            color: #f00;
            font-size: 10px;
            display: none;
        }
        
        .boss-name.show {
            display: block;
        }
        
        .chaos-mode canvas {
            animation: chaosGlow 0.1s infinite;
        }
        
        @keyframes chaosGlow {
            0% { box-shadow: 0 0 20px #f00; }
            25% { box-shadow: 0 0 20px #0f0; }
            50% { box-shadow: 0 0 20px #00f; }
            75% { box-shadow: 0 0 20px #ff0; }
            100% { box-shadow: 0 0 20px #f0f; }
        }
        
        .daily-challenge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #0ff;
            padding: 10px;
            font-size: 8px;
            color: #0ff;
            display: none;
        }
        
        .daily-challenge.show {
            display: block;
        }
        
        .daily-challenge.complete {
            border-color: #0f0;
            color: #0f0;
        }
        
        .meteor {
            position: absolute;
            width: 30px;
            height: 30px;
            pointer-events: none;
            font-size: 20px;
            animation: meteorFall 2s linear forwards;
        }
        
        @keyframes meteorFall {
            0% { transform: translateY(-50px); opacity: 1; }
            100% { transform: translateY(550px); opacity: 0; }
        }
        
        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0;
            z-index: 100;
        }
        
        .screen-flash.flash {
            animation: flashAnim 0.2s;
        }
        
        @keyframes flashAnim {
            0% { opacity: 0.8; background: #fff; }
            100% { opacity: 0; background: #fff; }
        }
        
        .glitch-mode canvas {
            filter: blur(1px) contrast(2);
            animation: glitchAnim 0.1s infinite;
        }
        
        @keyframes glitchAnim {
            0% { transform: translate(2px, 0); }
            25% { transform: translate(-2px, 0); }
            50% { transform: translate(0, 2px); }
            75% { transform: translate(0, -2px); }
            100% { transform: translate(0, 0); }
        }
        
        .glitch-mode h1 {
            animation: glitchText 0.2s infinite;
        }
        
        @keyframes glitchText {
            0% { transform: translateX(-2px); filter: hue-rotate(0deg); }
            25% { transform: translateX(2px); filter: hue-rotate(90deg); }
            50% { transform: translateX(-1px); filter: hue-rotate(180deg); }
            75% { transform: translateX(1px); filter: hue-rotate(270deg); }
            100% { transform: translateX(0); filter: hue-rotate(360deg); }
        }
        
        .credits-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            color: #0f0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            font-family: monospace;
            overflow: hidden;
        }
        
        .credits-overlay.show {
            display: flex;
            animation: creditsScroll 10s linear forwards;
        }
        
        @keyframes creditsScroll {
            0% { transform: translateY(100%); }
            100% { transform: translateY(-200%); }
        }
        
        .credit-line {
            font-size: 14px;
            margin: 10px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .credit-title {
            font-size: 24px;
            color: #ff0;
            margin: 30px 0;
        }
        
        .credits-skip {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: #666;
            font-size: 10px;
        }
        
        .minimap {
            position: absolute;
            top: 10px;
            right: -120px;
            width: 100px;
            height: 100px;
            border: 2px solid #0ff;
            background: rgba(0,0,0,0.5);
            transition: right 0.3s;
        }
        
        .minimap.show {
            right: 10px;
        }
        
        .minimap-snake {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #0f0;
        }
        
        .minimap-food {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ff0;
            border-radius: 50%;
        }
        
        .spirit-indicator {
            position: absolute;
            top: -60px;
            left: 0;
            font-size: 10px;
            color: #f0f;
        }
        
        .multiplayer-score {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #f0f;
            padding: 10px;
            font-size: 8px;
            color: #f0f;
            display: none;
        }
        
        .multiplayer-score.show {
            display: block;
        }
        
        .matrix-mode {
            background: #000 !important;
        }
        
        .matrix-mode canvas {
            filter: hue-rotate(90deg);
        }
        
        .matrix-mode canvas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 0, 0.1) 2px,
                rgba(0, 255, 0, 0.1) 4px
            );
            pointer-events: none;
        }
        
        .shop-panel {
            position: fixed;
            bottom: -200px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            border: 2px solid #ff0;
            padding: 15px;
            transition: bottom 0.3s;
            z-index: 100;
        }
        
        .shop-panel.show {
            bottom: 20px;
        }
        
        .shop-item {
            display: inline-block;
            margin: 5px;
            padding: 10px;
            background: #222;
            border: 1px solid #444;
            font-size: 8px;
            cursor: pointer;
        }
        
        .shop-item:hover {
            background: #333;
            border-color: #ff0;
        }
        
        .shop-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .mutation-indicator {
            position: absolute;
            top: -80px;
            left: 0;
            font-size: 10px;
            color: #f0f;
        }
        
        .hacker {
            position: absolute;
            width: 20px;
            height: 20px;
            font-size: 14px;
            animation: hackerFloat 3s infinite;
        }
        
        @keyframes hackerFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .time-travel-flash {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            opacity: 0;
            pointer-events: none;
            z-index: 300;
        }
        
        .time-travel-flash.active {
            animation: timeTravel 1s;
        }
        
        @keyframes timeTravel {
            0% { opacity: 1; }
            10% { opacity: 0; }
            20% { opacity: 1; }
            30% { opacity: 0; }
            40% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 0; }
        }
        
        .reality-fracture {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 250;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .reality-fracture.active {
            opacity: 1;
            animation: realityCrack 0.1s infinite;
        }
        
        @keyframes realityCrack {
            0% { clip-path: inset(10% 0 80% 0); }
            25% { clip-path: inset(80% 0 10% 0); }
            50% { clip-path: inset(0 10% 0 80%); }
            75% { clip-path: inset(0 80% 0 10%); }
            100% { clip-path: inset(10% 0 80% 0); }
        }
        
        .clone-army {
            position: absolute;
            font-size: 10px;
            animation: cloneFloat 2s infinite;
        }
        
        @keyframes cloneFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(5deg); }
        }
        
        .blessing-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #ffd700;
            padding: 20px;
            text-align: center;
            z-index: 200;
            display: none;
        }
        
        .blessing-panel.show {
            display: block;
            animation: blessingAppear 0.5s;
        }
        
        @keyframes blessingAppear {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .blessing-btn {
            display: block;
            margin: 10px;
            padding: 15px 30px;
            background: #222;
            border: 2px solid #ffd700;
            color: #ffd700;
            font-family: inherit;
            font-size: 10px;
            cursor: pointer;
        }
        
        .blessing-btn:hover {
            background: #ffd700;
            color: #000;
        }
        
        .curse-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 150;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .curse-overlay.show {
            opacity: 1;
        }
        
        .inception-level {
            position: fixed;
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            border: 2px solid #0ff;
            z-index: 180;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .inception-level.show {
            opacity: 0.5;
            animation: inceptionPulse 2s infinite;
        }
        
        @keyframes inceptionPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .final-boss {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 500;
        }
        
        .final-boss.show {
            display: flex;
        }
        
        .boss-entity {
            font-size: 100px;
            animation: bossFloat 1s infinite;
        }
        
        @keyframes bossFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .boss-health {
            width: 300px;
            height: 20px;
            background: #333;
            margin-top: 20px;
            border: 2px solid #f00;
        }
        
        .boss-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #f00, #ff0);
            transition: width 0.3s;
        }
        
        .liquid-mode canvas {
            filter: blur(2px);
        }
        
        .liquid-mode canvas::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><filter id="liquid"><feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="3" result="noise"/><feDisplacementMap in="SourceGraphic" in2="noise" scale="10"/></filter></svg>');
            filter: url(#liquid);
            pointer-events: none;
            animation: liquidAnim 2s infinite;
        }
        
        @keyframes liquidAnim {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.02) rotate(1deg); }
            50% { transform: scale(0.98) rotate(0deg); }
            75% { transform: scale(1.01) rotate(-1deg); }
        }
        
        .mirror-dimension {
            position: absolute;
            top: 50%;
            right: -200px;
            transform: translateY(-50%);
            width: 200px;
            height: 200px;
            border: 2px solid #f0f;
            transform: scaleX(-1);
            opacity: 0;
            transition: right 0.5s, opacity 0.5s;
            z-index: 10;
        }
        
        .mirror-dimension.show {
            right: 10px;
            opacity: 0.7;
        }
        
        .virus-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 10px,
                rgba(0,255,0,10%) 10px,
                rgba(0,255,0,10%) 20px
            );
            pointer-events: none;
            opacity: 0;
            z-index: 60;
        }
        
        .virus-overlay.active {
            opacity: 1;
            animation: virusScan 0.5s infinite;
        }
        
        @keyframes virusScan {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }
        
        .auto-play-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            color: #0f0;
            display: none;
            z-index: 70;
        }
        
        .auto-play-indicator.show {
            display: block;
            animation: autoPlayBlink 0.5s infinite;
        }
        
        @keyframes autoPlayBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .quantum-superposition {
            position: absolute;
            font-size: 12px;
            animation: quantumFloat 1s infinite;
        }
        
        @keyframes quantumFloat {
            0%, 100% { transform: translate(0, 0); opacity: 0.5; }
            50% { transform: translate(5px, -5px); opacity: 1; }
        }
        
        .gravity-zone {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            pointer-events: none;
            animation: gravityPulse 2s infinite;
        }
        
        @keyframes gravityPulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.6; }
        }
        
        .portal-gun-cursor {
            cursor: crosshair !important;
        }
        
        .food-mode canvas {
            cursor: crosshair;
        }
        
        .evolution-progress {
            position: absolute;
            top: -95px;
            left: 0;
            width: 100%;
            height: 5px;
            background: #333;
        }
        
        .evolution-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f0, #0ff, #f0f);
            transition: width 0.5s;
        }
        
        .god-view {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 800;
        }
        
        .god-view.show {
            display: flex;
        }
        
        .god-eyes {
            font-size: 50px;
            animation: godWatch 2s infinite;
        }
        
        @keyframes godWatch {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .sticker {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 90;
            animation: stickerFloat 3s infinite;
        }
        
        @keyframes stickerFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(10deg); }
        }
        
        .trauma-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            opacity: 0;
            z-index: 900;
        }
        
        .trauma-flash.active {
            animation: trauma 0.1s 3;
        }
        
        @keyframes trauma {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .infinite-tunnel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, transparent 0%, #000 100%);
            pointer-events: none;
            opacity: 0;
            z-index: 85;
        }
        
        .infinite-tunnel.show {
            opacity: 1;
            animation: tunnelSpin 2s linear infinite;
        }
        
        @keyframes tunnelSpin {
            0% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
            50% { transform: translate(-50%, -50%) rotate(180deg) scale(0.5); }
            100% { transform: translate(-50%, -50%) rotate(360deg) scale(1); }
        }
        
        .neon-overload {
            animation: neonFlicker 0.1s infinite;
        }
        
        @keyframes neonFlicker {
            0% { filter: hue-rotate(0deg) brightness(1); }
            25% { filter: hue-rotate(90deg) brightness(1.5); }
            50% { filter: hue-rotate(180deg) brightness(0.8); }
            75% { filter: hue-rotate(270deg) brightness(1.2); }
            100% { filter: hue-rotate(360deg) brightness(1); }
        }
        
        .dream-layer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 75;
            opacity: 0;
            transition: opacity 1s;
        }
        
        .dream-layer.show {
            opacity: 0.3;
            animation: dreamWarp 5s infinite;
        }
        
        @keyframes dreamWarp {
            0%, 100% { transform: scale(1); filter: blur(0px); }
            50% { transform: scale(1.1); filter: blur(2px); }
        }
        
        .pixel-storm {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 80;
            opacity: 0;
        }
        
        .pixel-storm.active {
            opacity: 1;
            animation: pixelRain 0.5s linear infinite;
        }
        
        @keyframes pixelRain {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }
        
        .size-rainbow-text {
            background: linear-gradient(90deg, #f00, #ff0, #0f0, #0ff, #00f, #f0f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowMove 1s linear infinite;
        }
        
        @keyframes rainbowMove {
            0% { background-position: 0 0; }
            100% { background-position: 100px 0; }
        }
        
        .hacker-terminal {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #000;
            color: #0f0;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 2px solid #0f0;
            display: none;
            z-index: 100;
        }
        
        .hacker-terminal.show {
            display: block;
        }
        
        .joker-laugh {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f00;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            z-index: 950;
        }
        
        .joker-laugh.show {
            display: flex;
            animation: jokerFlash 0.2s 5;
        }
        
        @keyframes jokerFlash {
            0%, 100% { background: #f00; }
            50% { background: #000; }
        }
        
        .dimension-rip {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 70;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }
        
        .dimension-rip.active {
            opacity: 1;
            animation: dimensionTear 0.5s forwards;
        }
        
        @keyframes dimensionTear {
            0% { clip-path: inset(50% 50% 50% 50%); }
            100% { clip-path: inset(0% 0% 0% 0%); }
        }
        
        .reality-delete {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, transparent 30%, #000 70%);
            pointer-events: none;
            z-index: 60;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .reality-delete.active {
            opacity: 1;
            animation: realityShrink 3s forwards;
        }
        
        @keyframes realityShrink {
            0% { background: radial-gradient(circle, transparent 30%, #000 70%); }
            100% { background: radial-gradient(circle, transparent 0%, #000 100%); }
        }
        
        .memories-panel {
            position: fixed;
            bottom: -300px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid #ff0;
            padding: 15px;
            transition: bottom 0.3s;
            z-index: 100;
            width: 300px;
        }
        
        .memories-panel.show {
            bottom: 20px;
        }
        
        .memory-item {
            color: #ff0;
            font-size: 8px;
            margin: 5px 0;
            padding: 5px;
            border-left: 2px solid #ff0;
        }
        
        .game-within-game {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 150px;
            height: 150px;
            border: 2px solid #0ff;
            background: #000;
            display: none;
            z-index: 90;
        }
        
        .game-within-game.show {
            display: block;
        }
        
        .pocket-snake {
            position: absolute;
            font-size: 10px;
        }
        
        .omnipresent {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,0,255,0.03) 10px,
                rgba(255,0,255,0.03) 20px
            );
            pointer-events: none;
            z-index: 55;
            opacity: 0;
        }
        
        .omnipresent.active {
            opacity: 1;
            animation: omniMove 5s linear infinite;
        }
        
        @keyframes omniMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(20px, 20px); }
        }
        
        .reverse-score {
            direction: rtl;
            unicode-bidi: bidi-override;
        }
        
        .chaos-universe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 45;
            opacity: 0;
        }
        
        .chaos-universe.active {
            opacity: 1;
            animation: chaosBg 0.5s infinite;
        }
        
        @keyframes chaosBg {
            0% { background: #f00; }
            16% { background: #ff0; }
            33% { background: #0f0; }
            50% { background: #0ff; }
            66% { background: #00f; }
            83% { background: #f0f; }
            100% { background: #f00; }
        }
        
        .time-freeze {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, transparent 50%, #fff 150%);
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
        }
        
        .time-freeze.active {
            opacity: 0.5;
            animation: freezeTime 0.1s infinite;
        }
        
        @keyframes freezeTime {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }
        
        .existential-crisis {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 1100;
        }
        
        .existential-crisis.show {
            display: flex;
            animation: existBlink 0.5s 10;
        }
        
        @keyframes existBlink {
            0%, 100% { background: #000; }
            50% { background: #fff; }
        }
        
        .exist-text {
            color: #fff;
            font-size: 10px;
            text-align: center;
            max-width: 80%;
        }
        
        .player-ghost {
            position: absolute;
            opacity: 0.5;
            font-size: 10px;
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #0ff;
            padding: 30px;
            text-align: center;
            z-index: 1200;
            display: none;
        }
        
        .tutorial-overlay.show {
            display: block;
        }
        
        .tutorial-text {
            color: #0ff;
            font-size: 10px;
            line-height: 2;
        }
        
        .tutorial-btn {
            margin-top: 20px;
            padding: 10px 30px;
            background: #0ff;
            border: none;
            color: #000;
            font-family: inherit;
            cursor: pointer;
        }
        
        .dimension-wall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100px;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 10px,
                #f0f 10px,
                #f0f 12px
            );
            pointer-events: none;
            z-index: 25;
            opacity: 0;
            animation: wallPulse 1s infinite;
        }
        
        .dimension-wall.left { left: 0; }
        .dimension-wall.right { 
            right: 0; 
            left: auto;
        }
        
        .dimension-wall.active { opacity: 0.5; }
        
        @keyframes wallPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        .play-god {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 200px;
            display: none;
            z-index: 2000;
            animation: godFloat 3s infinite;
        }
        
        .play-god.show { display: block; }
        
        @keyframes godFloat {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(10deg); }
        }
        
        .rewind-effect {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255,255,255,0.1) 2px,
                rgba(255,255,255,0.1) 4px
            );
            pointer-events: none;
            z-index: 1500;
            opacity: 0;
            animation: rewindLines 0.2s linear infinite;
        }
        
        .rewind-effect.active { opacity: 1; }
        
        @keyframes rewindLines {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }
        
        .play-as-food {
            cursor: crosshair !important;
        }
        
        .play-as-food canvas { cursor: crosshair; }
        
        .enemy-snake {
            position: absolute;
            color: #f00;
            font-size: 12px;
        }
        
        .multiple-snake-mode canvas {
            border: 5px dashed #f00;
        }
        
        .ghost-racer {
            position: fixed;
            top: 100px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #0ff;
            padding: 10px;
            font-size: 8px;
            color: #0ff;
            display: none;
        }
        
        .ghost-racer.show { display: block; }
        
        .reality-breaker {
            position: fixed;
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            border: 3px solid #f0f;
            border-radius: 50%;
            pointer-events: none;
            z-index: 200;
            opacity: 0;
            animation: breakerPulse 2s infinite;
        }
        
        .reality-breaker.active {
            opacity: 1;
            animation: breakerSpin 2s linear infinite;
        }
        
        @keyframes breakerPulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.5); opacity: 1; }
        }
        
        @keyframes breakerSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chaos-everything {
            animation: chaosEverything 0.1s infinite;
        }
        
        @keyframes chaosEverything {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            25% { transform: translate(-1px, -1px) rotate(-1deg); }
            50% { transform: translate(2px, -2px) rotate(1deg); }
            75% { transform: translate(-2px, 2px) rotate(0deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }
        
        .mirror-world {
            position: fixed;
            top: 0;
            right: 0;
            width: 30%;
            height: 100%;
            background: rgba(0,255,255,0.1);
            transform: scaleX(-1);
            pointer-events: none;
            z-index: 15;
            display: none;
        }
        
        .mirror-world.show { display: block; }
        
        .play-as-enemy {
            cursor: not-allowed !important;
        }
        
        .enemy-cursor {
            position: fixed;
            font-size: 30px;
            pointer-events: none;
            z-index: 1000;
            animation: enemyChase 2s infinite;
        }
        
        @keyframes enemyChase {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .portal-storm {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 35;
            opacity: 0;
        }
        
        .portal-storm.active {
            opacity: 1;
            animation: portalSpin 3s linear infinite;
        }
        
        @keyframes portalSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.5); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .game-evolution {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #0f0;
            padding: 10px;
            font-size: 8px;
            color: #0f0;
            display: none;
        }
        
        .game-evolution.show { display: block; }
        
        .evolution-stage {
            display: inline-block;
            margin: 2px;
            opacity: 0.3;
        }
        
        .evolution-stage.active { opacity: 1; }
        
        .infinite-dimension {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, #000 0%, #111 50%, #000 100%);
            pointer-events: none;
            z-index: 20;
            opacity: 0;
        }
        
        .infinite-dimension.active {
            opacity: 1;
            animation: infiniteDimensionPulse 5s infinite;
        }
        
        @keyframes infiniteDimensionPulse {
            0%, 100% { background: radial-gradient(circle, #000 0%, #111 50%, #000 100%); }
            50% { background: radial-gradient(circle, #111 0%, #000 50%, #111 100%); }
        }
        
        .boss-rush {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #f00;
            padding: 30px;
            text-align: center;
            z-index: 600;
            display: none;
        }
        
        .boss-rush.show { display: block; }
        
        .boss-health-bar {
            width: 200px;
            height: 20px;
            background: #333;
            margin: 10px auto;
            border: 2px solid #f00;
        }
        
        .boss-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #f00, #ff0);
            transition: width 0.3s;
        }
        
        .multi-dimension {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 18;
        }
        
        .dimension-view {
            position: absolute;
            width: 50%;
            height: 50%;
            border: 1px solid;
            opacity: 0.3;
        }
        
        .dimension-view.tl { top: 0; left: 0; border-color: #f00; }
        .dimension-view.tr { top: 0; right: 0; border-color: #0f0; }
        .dimension-view.bl { bottom: 0; left: 0; border-color: #00f; }
        .dimension-view.br { bottom: 0; right: 0; border-color: #ff0; }
        
        .game-war {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(100,0,0,0.3);
            pointer-events: none;
            z-index: 22;
            display: none;
        }
        
        .game-war.show { display: block; }
        
        .war-timer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 50px;
            color: #f00;
            z-index: 700;
            display: none;
        }
        
        .war-timer.show { display: block; }
        
        .dimension-merge {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 17;
            mix-blend-mode: screen;
            opacity: 0;
        }
        
        .dimension-merge.active {
            opacity: 0.5;
            animation: dimensionMergePulse 2s infinite;
        }
        
        @keyframes dimensionMergePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .yinyang {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 16;
            opacity: 0;
        }
        
        .yinyang.active {
            opacity: 0.3;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #000 50%, #fff 100%);
        }
        
        .fourth-wall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 3000;
        }
        
        .fourth-wall.show { display: flex; }
        
        .fourth-wall-text {
            color: #fff;
            font-size: 14px;
            text-align: center;
            max-width: 80%;
            line-height: 2;
        }
        
        .cheat-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 15px;
            background: #222;
            border: 2px solid #f0f;
            color: #f0f;
            font-family: inherit;
            font-size: 10px;
            cursor: pointer;
            z-index: 100;
        }
        
        .cheat-btn:hover {
            background: #f0f;
            color: #000;
        }
        
        .cheat-panel {
            position: fixed;
            bottom: 60px;
            left: 20px;
            background: rgba(0,0,0,0.95);
            border: 2px solid #f0f;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            width: 250px;
        }
        
        .cheat-panel.show {
            display: block;
        }
        
        .cheat-item {
            color: #fff;
            font-size: 8px;
            padding: 5px;
            margin: 2px 0;
            cursor: pointer;
            border: 1px solid #333;
        }
        
        .cheat-item:hover {
            background: #f0f;
            color: #000;
        }
        
        .pocket-universe {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            border: 3px solid #0ff;
            border-radius: 50%;
            background: radial-gradient(circle, #001a33 0%, #000 100%);
            display: none;
            z-index: 2000;
        }
        
        .pocket-universe.show { display: block; animation: universePulse 2s infinite; }
        
        @keyframes universePulse {
            0%, 100% { box-shadow: 0 0 30px #0ff; }
            50% { box-shadow: 0 0 60px #0ff; }
        }
        
        .galaxy-snake {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: radial-gradient(circle, #fff, #0ff, transparent);
            animation: galaxySpin 1s infinite;
        }
        
        @keyframes galaxySpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .rng-god {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, #fff 0%, #000 100%);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 3000;
        }
        
        .rng-god.show { display: flex; }
        
        .rng-text {
            color: #000;
            font-size: 30px;
            animation: rngText 0.5s infinite;
        }
        
        @keyframes rngText {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .inception-dream {
            position: fixed;
            top: 0;
            left: 0;
            width: 50%;
            height: 50%;
            border: 2px dashed #f0f;
            display: none;
            z-index: 100;
        }
        
        .inception-dream.show { display: block; }
        
        .dream-layer-2 {
            position: fixed;
            top: 0;
            right: 0;
            width: 40%;
            height: 40%;
            border: 2px dotted #0ff;
            display: none;
            z-index: 99;
        }
        
        .dream-layer-2.show { display: block; }
        
        .shadow-snake {
            position: absolute;
            background: rgba(0,0,0,0.5);
            filter: blur(5px);
        }
        
        .timeloop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,0,255,0.05) 10px,
                rgba(255,0,255,0.05) 20px
            );
            pointer-events: none;
            z-index: 50;
            opacity: 0;
        }
        
        .timeloop.active { opacity: 1; animation: timeloopMove 5s linear infinite; }
        
        @keyframes timeloopMove {
            0% { background-position: 0 0; }
            100% { background-position: 100px 100px; }
        }
        
        .multiverse-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            z-index: 90;
        }
        
        .multiverse-view.show { display: flex; flex-wrap: wrap; }
        
        .universe-instance {
            width: 25vw;
            height: 25vh;
            border: 1px solid;
            opacity: 0.5;
        }
        
        .player-avatar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            display: none;
            z-index: 95;
        }
        
        .player-avatar.show { display: block; }
        
        .inventory-panel {
            position: fixed;
            top: 100px;
            right: -200px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #0f0;
            padding: 15px;
            width: 180px;
            transition: right 0.3s;
            z-index: 100;
        }
        
        .inventory-panel.show { right: 10px; }
        
        .inventory-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 10px;
            color: #0f0;
        }
        
        .ability-tree {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #ffd700;
            padding: 20px;
            display: none;
            z-index: 500;
            width: 400px;
        }
        
        .ability-tree.show { display: block; }
        
        .ability-node {
            display: inline-block;
            width: 60px;
            height: 60px;
            border: 2px solid #444;
            margin: 5px;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
        }
        
        .ability-node.unlocked { border-color: #ffd700; background: #222; }
        
        .reality-hack {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,255,0,0.1);
            pointer-events: none;
            z-index: 80;
            display: none;
        }
        
        .reality-hack.active { display: block; animation: realityHack 0.2s infinite; }
        
        @keyframes realityHack {
            0% { background: rgba(0,255,0,0.05); }
            50% { background: rgba(0,255,0,0.15); }
            100% { background: rgba(0,255,0,0.05); }
        }
        
        .echo-chamber {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            border: 2px solid #f00;
            padding: 10px;
            font-size: 10px;
            color: #f00;
            display: none;
            z-index: 95;
        }
        
        .echo-chamber.show { display: block; }
        
        .echo-msg {
            opacity: 0;
            animation: echoFade 3s forwards;
        }
        
        @keyframes echoFade {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .void-worm {
            position: fixed;
            font-size: 100px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .void-worm.show { display: block; animation: voidWorm 3s infinite; }
        
        @keyframes voidWorm {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(50px, -30px) rotate(90deg); }
            50% { transform: translate(0, -50px) rotate(180deg); }
            75% { transform: translate(-50px, -30px) rotate(270deg); }
        }
        
        .game-creator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #fff;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 4000;
        }
        
        .game-creator.show { display: flex; }
        
        .creator-text {
            color: #000;
            font-size: 20px;
            text-align: center;
        }
        
        .the-answer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 150px;
            display: none;
            z-index: 5000;
        }
        
        .the-answer.show { display: block; animation: answerAppear 2s forwards; }
        
        @keyframes answerAppear {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .god-mode-true {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, #fff 0%, #ffd700 30%, #000 70%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 6000;
        }
        
        .god-mode-true.show { display: flex; animation: godTrue 5s forwards; }
        
        @keyframes godTrue {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .neural-network {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 85;
            opacity: 0;
        }
        
        .neural-network.active {
            opacity: 1;
            animation: neuralPulse 2s infinite;
        }
        
        @keyframes neuralPulse {
            0%, 100% { background: radial-gradient(circle at 20% 30%, #00f1 0%, transparent 30%), radial-gradient(circle at 80% 70%, #f100 0%, transparent 30%); }
            50% { background: radial-gradient(circle at 80% 30%, #00f1 0%, transparent 30%), radial-gradient(circle at 20% 70%, #f100 0%, transparent 30%); }
        }
        
        .quantum-reality {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(45deg, #000 25%, #111 25%, #111 50%, #000 50%, #000 75%, #111 75%);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 75;
            opacity: 0;
            animation: quantumMove 0.5s linear infinite;
        }
        
        .quantum-reality.active { opacity: 0.3; }
        
        @keyframes quantumMove {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }
        
        .void-reached {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle, #000 0%, #000 100%);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 7000;
        }
        
        .void-reached.show { display: flex; }
        
        .void-text {
            color: #333;
            font-size: 10px;
            text-align: center;
        }
        
        .save-file {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #0ff;
            padding: 20px;
            z-index: 800;
            display: none;
        }
        
        .save-file.show { display: block; }
        
        .save-slot {
            padding: 10px;
            margin: 5px;
            border: 1px solid #444;
            cursor: pointer;
        }
        
        .save-slot:hover { background: #222; }
        
        .ascension-gate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at 50% 50%, #fff 0%, #000 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9000;
        }
        
        .ascension-gate.show { display: flex; animation: ascendGate 3s forwards; }
        
        @keyframes ascendGate {
            0% { background: radial-gradient(circle, #fff 0%, #000 100%); }
            50% { background: radial-gradient(circle, #ffd700 0%, #000 100%); }
            100% { background: radial-gradient(circle, #fff 0%, #000 100%); }
        }
        
        .final-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 200px;
            display: none;
            z-index: 9500;
        }
        
        .final-form.show { display: block; animation: finalForm 2s infinite; }
        
        @keyframes finalForm {
            0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.1) rotate(10deg); }
        }
        
        .reality-engine {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            z-index: 10000;
        }
        
        .reality-engine.show { display: block; }
        
        .engine-ui {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #0f0;
            padding: 15px;
            color: #0f0;
            font-size: 10px;
        }
        
        .engine-btn {
            display: block;
            margin: 5px 0;
            padding: 5px 10px;
            background: #003300;
            border: 1px solid #0f0;
            color: #0f0;
            cursor: pointer;
        }
        
        .dimension-zero {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 11000;
        }
        
        .dimension-zero.show { display: flex; }
        
        .zero-text {
            color: #fff;
            font-size: 5px;
            animation: zeroType 5s forwards;
        }
        
        @keyframes zeroType {
            0% { content: ""; }
            100% { content: "Has alcanzado la dimensin cero. Todo termina aqu."; }
        }
        
        .ending-sequence {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 12000;
        }
        
        .ending-sequence.show { display: flex; }
        
        .ending-text {
            color: #fff;
            font-size: 12px;
            margin: 20px 0;
            animation: endingFade 3s forwards;
        }
        
        @keyframes endingFade {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .newgame-plus {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #1a0033 0%, #000 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 13000;
        }
        
        .newgame-plus.show { display: flex; }
        
        .ngp-text {
            color: #f0f;
            font-size: 30px;
            animation: ngpPulse 1s infinite;
        }
        
        @keyframes ngpPulse {
            0%, 100% { text-shadow: 0 0 10px #f0f; }
            50% { text-shadow: 0 0 30px #f0f, 0 0 50px #f0f; }
        }
        
        .god-tier {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle, #fff 0%, #ffd700 30%, #ff8c00 60%, #000 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 14000;
        }
        
        .god-tier.show { display: flex; animation: godTier 5s forwards; }
        
        @keyframes godTier {
            0% { opacity: 0; }
            30% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
        
        .cosmic-horror {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, #1a0a2a 0%, #000 100%);
            pointer-events: none;
            z-index: 40;
            opacity: 0;
        }
        
        .cosmic-horror.active {
            opacity: 1;
            animation: cosmicPulse 3s infinite;
        }
        
        @keyframes cosmicPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .ascended-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, #fff 0%, transparent 50%);
            pointer-events: none;
            z-index: 35;
            opacity: 0;
        }
        
        .ascended-mode.active {
            opacity: 0.3;
            animation: ascendGlow 2s infinite;
        }
        
        @keyframes ascendGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .delete-self {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 2000;
            display: none;
        }
        
        .delete-self.active {
            display: block;
            animation: deleteAll 2s forwards;
        }
        
        @keyframes deleteAll {
            0% { background: #fff; }
            50% { background: #000; }
            100% { background: #fff; }
        }
        
        .infinite-game {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: repeating-linear-gradient(
                0deg,
                #000 0px,
                #000 20px,
                #111 20px,
                #111 40px
            );
            pointer-events: none;
            z-index: 30;
            opacity: 0;
        }
        
        .infinite-game.active {
            opacity: 1;
            animation: infiniteScroll 10s linear infinite;
        }
        
        @keyframes infiniteScroll {
            0% { background-position: 0 0; }
            100% { background-position: 0 1000px; }
        }
    </style>
        
        .skin-badge {
            position: absolute;
            top: -55px;
            left: 0;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 3px;
        }
        
        .dual-snake-indicator {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #0ff;
            padding: 10px;
            font-size: 8px;
            color: #0ff;
            display: none;
        }
        
        .dual-snake-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SNAKE ULTRA</h1>
        <div class="game-info">
            <div class="score-box">SCORE: <span id="score">0</span></div>
            <div class="combo-box">COMBO: x<span id="combo">1</span></div>
            <div class="highscore-box">HIGH: <span id="highscore">0</span></div>
        </div>
        <div class="power-indicator">
            <div class="power invincible" id="powerInvincible"> INVENCIBLE</div>
            <div class="power x2" id="powerX2"> x2 PUNTOS</div>
            <div class="power slow" id="powerSlow"> LENTO</div>
            <div class="power short" id="powerShort"> CORTO</div>
            <div class="power inverted" id="powerInverted"> INVERTIDO</div>
            <div class="power ghost" id="powerGhost"> FANTASMA</div>
        </div>
        <canvas id="game" width="500" height="500"></canvas>
        <div class="event-display" id="eventDisplay"></div>
        <div class="message" id="message"></div>
    </div>
    <div class="void-approaching" id="voidEffect"></div>
    <div class="eye" id="eye"></div>
    <div class="achievement" id="achievement"></div>
    <div class="lives-display" id="lives"></div>
    <div class="boss-name" id="bossName"></div>
    <div class="boss-bar" id="bossBar"><div class="boss-bar-fill" id="bossBarFill"></div></div>
    <div class="daily-challenge" id="dailyChallenge"></div>
    <div class="screen-flash" id="screenFlash"></div>
    <div class="credits-overlay" id="creditsOverlay"></div>
    <div class="minimap" id="minimap"><div class="minimap-snake" id="minimapSnake"></div></div>
    <div class="spirit-indicator" id="spiritIndicator"></div>
    <div class="multiplayer-score" id="multiplayerScore"> IA: 0</div>
    <div class="time-travel-flash" id="timeTravelFlash"></div>
    <div class="dual-snake-indicator" id="dualSnakeIndicator"> P2: WASD</div>
    <div class="reality-fracture" id="realityFracture"></div>
    <div class="curse-overlay" id="curseOverlay"></div>
    <div class="inception-level" id="inceptionLevel"></div>
    <div class="blessing-panel" id="blessingPanel">
        <div style="color:#ffd700;margin-bottom:20px;font-size:14px;"> ELIGE TU DESTINO </div>
        <button class="blessing-btn" onclick="chooseBlessing('speed')"> Bendicin de Velocidad</button>
        <button class="blessing-btn" onclick="chooseBlessing('size')"> Bendicin de Tamao</button>
        <button class="blessing-btn" onclick="chooseBlessing('wisdom')"> Bendicin de Sabidura</button>
        <button class="blessing-btn" onclick="closeBlessing()"> Rechazar</button>
    </div>
    <div class="final-boss" id="finalBoss">
        <div class="boss-entity" id="bossEntity"></div>
        <div style="color:#f00;font-size:12px;margin-top:10px;">EL JUEGO FINAL</div>
        <div class="boss-health"><div class="boss-health-fill" id="bossHealthFill"></div></div>
    </div>
    <div class="virus-overlay" id="virusOverlay"></div>
    <div class="auto-play-indicator" id="autoPlayIndicator"> JUGANDO SOLO...</div>
    <div class="mirror-dimension" id="mirrorDimension"></div>
    <div class="god-view" id="godView">
        <div class="god-eyes"></div>
        <div style="color:#fff;margin-top:20px;font-size:12px;">TE ESTOY OBSERVANDO</div>
        <div style="color:#666;margin-top:10px;font-size:8px;">Tu snake me aburre</div>
    </div>
    <div class="trauma-flash" id="traumaFlash"></div>
    <div class="infinite-tunnel" id="infiniteTunnel"></div>
    <div class="dream-layer" id="dreamLayer"></div>
    <div class="pixel-storm" id="pixelStorm"></div>
    <div class="hacker-terminal" id="hackerTerminal">
        <div>TERMINAL DE HACKER</div>
        <div id="hackerText"></div>
    </div>
    <div class="joker-laugh" id="jokerLaugh"></div>
    <div class="dimension-rip" id="dimensionRip"></div>
    <div class="chat-overlay" id="chatOverlay"> [GLOBAL] Jugador: Esto es random!</div>
    <div class="blood-moon" id="bloodMoon"></div>
    <div class="void-entity" id="voidEntity">
        <div class="void-emoji"></div>
        <div style="color:#fff;font-size:20px;">EL VACO</div>
    </div>
    <div class="randomizer" id="randomizer"></div>
    <div class="reality-delete" id="realityDelete"></div>
    <div class="omnipresent" id="omnipresent"></div>
    <div class="chaos-universe" id="chaosUniverse"></div>
    <div class="time-freeze" id="timeFreeze"></div>
    <div class="existential-crisis" id="existentialCrisis">
        <div class="exist-text" id="existText"></div>
    </div>
    <div class="cosmic-horror" id="cosmicHorror"></div>
    <div class="ascended-mode" id="ascendedMode"></div>
    <div class="infinite-game" id="infiniteGame"></div>
    <div class="delete-self" id="deleteSelf"></div>
    <div class="game-within-game" id="gameWithinGame">
        <canvas id="pocketSnake" width="150" height="150"></canvas>
    </div>
    <div class="memories-panel" id="memoriesPanel">
        <div style="color:#ff0;margin-bottom:10px;"> MEMORIAS</div>
        <div id="memoriesList"></div>
    </div>
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-text" id="tutorialText"></div>
        <button class="tutorial-btn" onclick="closeTutorial()">ENTEND</button>
    </div>
    <button class="cheat-btn" onclick="toggleCheatPanel()"> CHEATS</button>
    <div class="cheat-panel" id="cheatPanel">
        <div style="color:#ff0;margin-bottom:10px;"> CODIGOS SECRETOS</div>
        <div class="cheat-item" onclick="runCheat('KONAMI')"> KONAMI - 99 vidas</div>
        <div class="cheat-item" onclick="runCheat('ABRACADABRA')"> ABRACADABRA - Arcoris</div>
        <div class="cheat-item" onclick="runCheat('CHAOS')"> CHAOS - Modo Caos</div>
        <div class="cheat-item" onclick="runCheat('METEOR')"> METEOR - Lluvia</div>
        <div class="cheat-item" onclick="runCheat('GLITCH')"> GLITCH - Glitch</div>
        <div class="cheat-item" onclick="runCheat('MATRIX')"> MATRIX - Matrix</div>
        <div class="cheat-item" onclick="runCheat('SPIRIT')"> SPIRIT - Spirit random</div>
        <div class="cheat-item" onclick="runCheat('MUTATE')"> MUTATE - Mutacin</div>
        <div class="cheat-item" onclick="runCheat('DUAL')"> DUAL - 2 jugadores</div>
        <div class="cheat-item" onclick="runCheat('TIME')"> TIME - Viaje tiempo</div>
        <div class="cheat-item" onclick="runCheat('REALITY')"> REALITY - Fractura</div>
        <div class="cheat-item" onclick="runCheat('BLESSING')"> BLESSING - Bendicin</div>
        <div class="cheat-item" onclick="runCheat('ENDGAME')"> ENDGAME - Boss Final</div>
        <div class="cheat-item" onclick="runCheat('VIRUS')"> VIRUS - Virus</div>
        <div class="cheat-item" onclick="runCheat('GOD')"> GOD - Vista Dios</div>
        <div class="cheat-item" onclick="runCheat('COSMIC')"> COSMIC - Horror Csmico</div>
        <div class="cheat-item" onclick="runCheat('NIGHTMARE')"> NIGHTMARE - Pesadilla</div>
        <div class="cheat-item" onclick="runCheat('TRUEEND')"> TRUEEND - Final Verdadero</div>
        <div class="cheat-item" onclick="runCheat('JOKER')"> JOKER - Joker</div>
        <div class="cheat-item" onclick="runCheat('VOID')"> VOID - Entidad Vaco</div>
        <div class="cheat-item" onclick="runCheat('EXIST')"> EXIST - Crisis Existencial</div>
        <div class="cheat-item" onclick="runCheat('FREEZE')"> FREEZE - Congelar Tiempo</div>
        <div class="cheat-item" onclick="runCheat('ASCEND')"> ASCEND - Modo Ascendido</div>
        <div class="cheat-item" onclick="runCheat('WALL')"> WALL - Muro Dimensional</div>
        <div class="cheat-item" onclick="runCheat('MIRROR')"> MIRROR - Dimensin Espejo</div>
        <div class="cheat-item" onclick="runCheat('FOURTH')"> FOURTH - Romper 4ta Pared</div>
        <div class="cheat-item" onclick="runCheat('POCKET')"> POCKET - Universo de Bolsillo</div>
        <div class="cheat-item" onclick="runCheat('RNG')"> RNG - Dios del Azar</div>
        <div class="cheat-item" onclick="runCheat('INCEPTION')"> INCEPTION - Sueo Profundo</div>
        <div class="cheat-item" onclick="runCheat('TIMELOOP')"> TIMELOOP - Bucle Temporal</div>
        <div class="cheat-item" onclick="runCheat('MULTIVERSE')"> MULTIVERSE - Vista Multiversal</div>
        <div class="cheat-item" onclick="runCheat('AVATAR')"> AVATAR - Tu Avatar</div>
        <div class="cheat-item" onclick="runCheat('INVENTORY')"> INVENTARIO - Ver Items</div>
        <div class="cheat-item" onclick="runCheat('ABILITY')"> ABILITY - rbol de Habilidades</div>
        <div class="cheat-item" onclick="runCheat('ECHO')"> ECHO - Cmara de Echo</div>
        <div class="cheat-item" onclick="runCheat('WORM')"> WORM - Gusano del Vaco</div>
        <div class="cheat-item" onclick="runCheat('CREATOR')"> CREATOR - Modo Creador</div>
        <div class="cheat-item" onclick="runCheat('ANSWER')">42 ANSWER - La Respuesta</div>
        <div class="cheat-item" onclick="runCheat('GODTRUE')"> GODTRUE - Dios Verdadero</div>
        <div class="cheat-item" onclick="runCheat('XP')"> XP - Ganar Experiencia</div>
        <div class="cheat-item" onclick="runCheat('HACK')"> HACK - Hackear Realidad</div>
        <div class="cheat-item" onclick="runCheat('NEURAL')"> NEURAL - Red Neural</div>
        <div class="cheat-item" onclick="runCheat('QUANTUM')"> QUANTUM - Realidad Cuntica</div>
        <div class="cheat-item" onclick="runCheat('VOIDREACH')"> VOIDREACH - Alcanzar el Vaco</div>
        <div class="cheat-item" onclick="runCheat('SAVE')"> SAVE - Sistema de Guardado</div>
        <div class="cheat-item" onclick="runCheat('ASCEND')"> ASCEND - Ascensin</div>
        <div class="cheat-item" onclick="runCheat('FINAL')"> FINAL - Forma Final</div>
        <div class="cheat-item" onclick="runCheat('ENGINE')"> ENGINE - Motor de Realidad</div>
        <div class="cheat-item" onclick="runCheat('ZERO')">0 ZERO - Dimensin Cero</div>
        <div class="cheat-item" onclick="runCheat('ENDING')"> ENDING - Secuencia Final</div>
        <div class="cheat-item" onclick="runCheat('NGP')"> NGP - Nuevo Juego+</div>
        <div class="cheat-item" onclick="runCheat('GODTIER')"> GODTIER - Nivel Dios</div>
    </div>
    <div class="dimension-wall left" id="dimensionWallLeft"></div>
    <div class="dimension-wall right" id="dimensionWallRight"></div>
    <div class="play-god" id="playGod"></div>
    <div class="rewind-effect" id="rewindEffect"></div>
    <div class="mirror-world" id="mirrorWorld"></div>
    <div class="reality-breaker" id="realityBreaker"></div>
    <div class="portal-storm" id="portalStorm"></div>
    <div class="game-evolution" id="gameEvolution"></div>
    <div class="infinite-dimension" id="infiniteDimension"></div>
    <div class="boss-rush" id="bossRush">
        <div style="color:#f00;font-size:12px;">WAVE <span id="waveNumber">1</span></div>
        <div class="boss-health-bar"><div class="boss-health-fill" id="bossRushHealth"></div></div>
    </div>
    <div class="multi-dimension" id="multiDimension">
        <div class="dimension-view tl"></div>
        <div class="dimension-view tr"></div>
        <div class="dimension-view bl"></div>
        <div class="dimension-view br"></div>
    </div>
    <div class="game-war" id="gameWar"></div>
    <div class="war-timer" id="warTimer">60</div>
    <div class="dimension-merge" id="dimensionMerge"></div>
    <div class="yinyang" id="yinyang"></div>
    <div class="fourth-wall" id="fourthWall">
        <div class="fourth-wall-text" id="fourthWallText"></div>
    </div>
    <div class="ghost-racer" id="ghostRacer"> Tu: <span id="ghostScore">0</span></div>
    <div class="pocket-universe" id="pocketUniverse"></div>
    <div class="rng-god" id="rngGod"><div class="rng-text" id="rngText">42</div></div>
    <div class="inception-dream" id="inceptionDream"></div>
    <div class="dream-layer-2" id="dreamLayer2"></div>
    <div class="timeloop" id="timeloop"></div>
    <div class="multiverse-view" id="multiverseView"></div>
    <div class="player-avatar" id="playerAvatar"></div>
    <div class="inventory-panel" id="inventoryPanel">
        <div style="color:#0f0;margin-bottom:10px;"> INVENTARIO</div>
        <div id="inventoryList"></div>
    </div>
    <div class="ability-tree" id="abilityTree">
        <div style="color:#ffd700;margin-bottom:15px;"> RBOL DE HABILIDADES</div>
        <div class="ability-node" onclick="unlockAbility(0)"></div>
        <div class="ability-node" onclick="unlockAbility(1)"></div>
        <div class="ability-node" onclick="unlockAbility(2)"></div>
        <div class="ability-node" onclick="unlockAbility(3)"></div>
        <div class="ability-node" onclick="unlockAbility(4)"></div>
    </div>
    <div class="reality-hack" id="realityHack"></div>
    <div class="echo-chamber" id="echoChamber"></div>
    <div class="void-worm" id="voidWorm"></div>
    <div class="game-creator" id="gameCreator">
        <div class="creator-text">Eres el CREADOR<br><br>Qu deseas crear?</div>
    </div>
    <div class="the-answer" id="theAnswer">42</div>
    <div class="god-mode-true" id="godModeTrue"></div>
    <div class="neural-network" id="neuralNetwork"></div>
    <div class="quantum-reality" id="quantumReality"></div>
    <div class="void-reached" id="voidReached">
        <div class="void-text">Has alcanzado el VACO<br><br>Todo Lo Que Existi... Termina Aqu</div>
    </div>
    <div class="save-file" id="saveFile">
        <div style="color:#0ff;margin-bottom:10px;"> GUARDAR/PARTIDAS</div>
        <div class="save-slot" onclick="saveGame(0)">Ranura 1</div>
        <div class="save-slot" onclick="saveGame(1)">Ranura 2</div>
        <div class="save-slot" onclick="saveGame(2)">Ranura 3</div>
    </div>
    <div class="ascension-gate" id="ascensionGate">
        <div style="color:#ffd700;font-size:30px;"> ASCENSIN</div>
    </div>
    <div class="final-form" id="finalForm"></div>
    <div class="reality-engine" id="realityEngine">
        <div class="engine-ui">
            <div> MOTOR DE REALIDAD</div>
            <div class="engine-btn" onclick="engineCreate('snake')"> Crear Snake</div>
            <div class="engine-btn" onclick="engineCreate('food')"> Crear Comida</div>
            <div class="engine-btn" onclick="engineCreate('wall')"> Crear Pared</div>
            <div class="engine-btn" onclick="engineDestroy()"> Destruir Todo</div>
        </div>
    </div>
    <div class="dimension-zero" id="dimensionZero">
        <div class="zero-text"></div>
    </div>
    <div class="ending-sequence" id="endingSequence"></div>
    <div class="newgame-plus" id="newgamePlus">
        <div class="ngp-text">NUEVO JUEGO+</div>
    </div>
    <div class="god-tier" id="godTier">
        <div style="color:#fff;font-size:40px;"> MODO DIOS</div>
    </div>
    <div class="shop-panel" id="shopPanel">
        <div style="color:#ff0;margin-bottom:10px;"> TIENDA</div>
        <div class="shop-item" data-item="invincible" data-cost="200"> Invencible (200)</div>
        <div class="shop-item" data-item="x2" data-cost="300"> x2 Puntos (300)</div>
        <div class="shop-item" data-item="slow" data-cost="150"> Lento (150)</div>
        <div class="shop-item" data-item="extraLife" data-cost="500"> Vida Extra (500)</div>
        <div class="shop-item" data-item="shrink" data-cost="250"> Achicar (250)</div>
    </div>
    <div class="secret-panel"></div>
    <div class="controls">ARROWS: Mover | ENTER: Reiniciar | P: Pausa</div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const GRID = 20;
        const TILE_COUNT = canvas.width / GRID;
        
        let snake = [];
        let food = { x: 10, y: 10 };
        let specialFoods = [];
        let particles = [];
        let portals = [];
        let direction = { x: 1, y: 0 };
        let nextDirection = { x: 1, y: 0 };
        let score = 0;
        let highscore = parseInt(localStorage.getItem('snakeHighscore')) || 0;
        let combo = 1;
        let lastEatTime = 0;
        let gameLoop = null;
        let isGameOver = false;
        let isPaused = false;
        let gameSpeed = 100;
        
        let meteoritos = [];
        let boss = null;
        let bossHealth = 100;
        let chaosMode = false;
        let dailyChallenge = null;
        let glitchMode = false;
        let spirit = null;
        let mines = [];
        let creditsPlayed = false;
        let showMinimap = false;
        let iaSnake = [];
        let iaScore = 0;
        let matrixMode = false;
        let mutation = null;
        let mutationTimer = 0;
        let hackers = [];
        let shopOpen = false;
        let currentSkin = 'rainbow';
        let skins = ['rainbow', 'fire', 'ice', 'toxic', 'gold', 'shadow'];
        let unlockedSkins = ['rainbow'];
        let dualMode = false;
        let snake2 = [];
        let direction2 = { x: 1, y: 0 };
        let realityFracture = false;
        let blessingActive = false;
        let curse = null;
        let inceptionLevel = 0;
        let finalBoss = null;
        let finalBossHealth = 1000;
        let clones = [];
        let gameLevel = 1;
        let liquidMode = false;
        let virusMode = false;
        let autoPlay = false;
        let mirrorDimension = false;
        let quantumSnake = [];
        let gravityZones = [];
        let portalGun = false;
        let foodMode = false;
        let evolution = 0;
        let evolutionStage = 0;
        let stickers = [];
        let godViewActive = false;
        let infiniteTunnel = false;
        let dreamMode = false;
        let pixelStorm = false;
        let hackerMode = false;
        let jokerMode = false;
        let chatActive = false;
        let bloodMoon = false;
        let voidEntity = false;
        let randomizerMode = false;
        let dimensionRift = false;
        let paradoxMode = false;
        let nightmareMode = false;
        let trueEnding = false;
        let omnipresentMode = false;
        let chaosUniverse = false;
        let timeFreeze = false;
        let existentialMode = false;
        let cosmicHorror = false;
        let ascendedMode = false;
        let infiniteGame = false;
        let deleteSelfMode = false;
        let memories = JSON.parse(localStorage.getItem('snakeMemories')) || [];
        let tutorialMode = false;
        let tutorialStep = 0;
        let dimensionWall = false;
        let playAsGod = false;
        let rewindMode = false;
        let mirrorWorld = false;
        let realityBreaker = false;
        let portalStorm = false;
        let gameEvolution = 0;
        let bossRushMode = false;
        let bossRushWave = 1;
        let bossRushHealth = 100;
        let multiDimension = false;
        let gameWar = false;
        let warTimer = 60;
        let dimensionMerge = false;
        let yinYang = false;
        let fourthWall = false;
        let ghostRacer = false;
        let ghostScore = 0;
        let enemySnakes = [];
        let pocketUniverse = false;
        let rngGod = false;
        let inceptionDream = false;
        let timeloop = false;
        let multiverseView = false;
        let playerAvatar = '';
        let inventory = JSON.parse(localStorage.getItem('snakeInventory')) || [];
        let abilityTree = false;
        let unlockedAbilities = [];
        let echoChamber = false;
        let voidWorm = false;
        let gameCreator = false;
        let theAnswer = false;
        let godModeTrue = false;
        let level = 1;
        let xp = 0;
        let neuralNetwork = false;
        let quantumReality = false;
        let voidReached = false;
        let saveSystem = false;
        let ascensionGate = false;
        let finalForm = false;
        let realityEngine = false;
        let dimensionZero = false;
        let endingSequence = false;
        let newgamePlus = false;
        let godTier = false;
        let ngplusLevel = 0;
        
        let powers = {
            invincible: { active: false, timer: 0 },
            x2: { active: false, timer: 0 },
            slow: { active: false, timer: 0 },
            short: { active: false, timer: 0 }
        };
        
        let events = {
            inverted: false,
            ghost: false,
            void: false,
            voidLevel: 0
        };
        
        let eventTimer = 0;
        let nextEventIn = Math.random() * 15000 + 15000;
        
        let snakeMessages = [
            "Vamos, movete!",
            "Me vas a hacer chocar?",
            "Tengo mal presentimiento...",
            "Ms rpido!",
            "Me gusta este poder",
            "Por qu soy verde?",
            "Creo que vi un portal",
            "CUIDADO",
            "Eso fue cerca!",
            "* bosteza *"
        ];
        
        let achievements = {
            firstBlood: { name: "Primera Sangre", unlocked: false },
            combo5: { name: "Combo x5", unlocked: false },
            powerUser: { name: "Adicto a los poderes", unlocked: false },
            portalSurvivor: { name: "Sobreviviente Dimensional", unlocked: false },
            voidEscape: { name: "Escap del Vaco", unlocked: false },
            godMode: { name: "Modo Dios", unlocked: false },
            konamiCode: { name: "Cdigo Secreto", unlocked: false },
            eyeSurvivor: { name: "Sobreviviste al Ojo", unlocked: false },
            escape: { name: "Buscaste la Salida", unlocked: false },
            diary: { name: "Diario de una Snake", unlocked: false }
        };
        
        let lives = 1;
        let rainbowMode = false;
        let eyeActive = false;
        let eyeFreeze = false;
        let escapeClicks = 0;
        let diary = JSON.parse(localStorage.getItem('snakeDiary')) || [];
        let deathCount = parseInt(localStorage.getItem('snakeDeaths')) || 0;
        let totalPlayTime = parseInt(localStorage.getItem('snakePlayTime')) || 0;
        let playSessionStart = Date.now();
        
        const KONAMI = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
        const ABRACADABRA = ['a','b','r','a','c','a','d','a','b','r','a'];
        const CHAOS = ['c','h','a','o','s'];
        const METEOR = ['m','e','t','e','o','r'];
        const GLITCH = ['g','l','i','t','c','h'];
        const MINIMAP = ['m','i','n','i','m','a','p'];
        const SPIRIT = ['s','p','i','r','i','t'];
        const MATRIX = ['m','a','t','r','i','x'];
        const SHOP = ['s','h','o','p'];
        const MUTATE = ['m','u','t','a','t','e'];
        const DUAL = ['d','u','a','l'];
        const TIME = ['t','i','m','e'];
        const REALITY = ['r','e','a','l','i','t','y'];
        const BLESSING = ['b','l','e','s','s','i','n','g'];
        const INCEPTION = ['i','n','c','e','p','t','i','o','n'];
        const CLONE = ['c','l','o','n','e'];
        const ENDGAME = ['e','n','d','g','a','m','e'];
        const LIQUID = ['l','i','q','u','i','d'];
        const VIRUS = ['v','i','r','u','s'];
        const AUTOPLAY = ['a','u','t','o','p','l','a','y'];
        const MIRROR = ['m','i','r','r','o','r'];
        const QUANTUM = ['q','u','a','n','t','u','m'];
        const GRAVITY = ['g','r','a','v','i','t','y'];
        const FOOD = ['f','o','o','d'];
        const EVOLVE = ['e','v','o','l','v','e'];
        const GOD = ['g','o','d'];
        const STICKER = ['s','t','i','c','k','e','r'];
        const TUNNEL = ['t','u','n','n','e','l'];
        const DREAM = ['d','r','e','a','m'];
        const PIXEL = ['p','i','x','e','l'];
        const HACKER = ['h','a','c','k','e','r'];
        const JOKER = ['j','o','k','e','r'];
        const CHAT = ['c','h','a','t'];
        const BLOOD = ['b','l','o','o','d'];
        const VOID = ['v','o','i','d'];
        const RANDOM = ['r','a','n','d','o','m'];
        const RIFT = ['r','i','f','t'];
        const PARADOX = ['p','a','r','a','d','o','x'];
        const NIGHTMARE = ['n','i','g','h','t','m','a','r','e'];
        const TRUEEND = ['t','r','u','e','e','n','d'];
        const WISPER = ['w','i','s','p','e','r'];
        const OMNI = ['o','m','n','i'];
        const FREEZE = ['f','r','e','e','z','e'];
        const EXIST = ['e','x','i','s','t'];
        const COSMIC = ['c','o','s','m','i','c'];
        const ASCEND = ['a','s','c','e','n','d'];
        const INFINITE = ['i','n','f','i','n','i','t','e'];
        const DELETE = ['d','e','l','e','t','e'];
        const MEMORY = ['m','e','m','o','r','y'];
        const TUTORIAL = ['t','u','t','o','r','i','a','l'];
        const WALL = ['w','a','l','l'];
        const GODMODE = ['g','o','d','m','o','d','e'];
        const REWIND = ['r','e','w','i','n','d'];
        const MIRROR2 = ['m','i','r','r','o','r','2'];
        const BREAK = ['b','r','e','a','k'];
        const STORM = ['s','t','o','r','m'];
        const EVOLVE2 = ['e','v','o','l','v','e','2'];
        const RUSH = ['r','u','s','h'];
        const MULTI = ['m','u','l','t','i'];
        const WAR = ['w','a','r'];
        const MERGE = ['m','e','r','g','e'];
        const YINYANG = ['y','i','n','y','a','n','g'];
        const FOURTH = ['f','o','u','r','t','h'];
        const GHOST = ['g','h','o','s','t'];
        const ENEMY = ['e','n','e','m','y'];
        
        let chaosIndex = 0, meteorIndex = 0, glitchIndex = 0, minimapIndex = 0, spiritIndex = 0, matrixIndex = 0, shopIndex = 0, mutateIndex = 0, dualIndex = 0, timeIndex = 0, realityIndex = 0, blessingIndex = 0, inceptionIndex = 0, cloneIndex = 0, endgameIndex = 0, liquidIndex = 0, virusIndex = 0, autoplayIndex = 0, mirrorIndex = 0, quantumIndex = 0, gravityIndex = 0, foodIndex = 0, evolveIndex = 0, godIndex = 0, stickerIndex = 0, tunnelIndex = 0, dreamIndex = 0, pixelIndex = 0, hackerIndex = 0, jokerIndex = 0, chatIndex = 0, bloodIndex = 0, voidIndex = 0, randomIndex = 0, riftIndex = 0, paradoxIndex = 0, nightmareIndex = 0, trueendIndex = 0, wisperIndex = 0, omniIndex = 0, freezeIndex = 0, existIndex = 0, cosmicIndex = 0, ascendIndex = 0, infiniteIndex = 0, deleteIndex = 0, memoryIndex = 0, tutorialIndex = 0, wallIndex = 0, godmodeIndex = 0, rewindIndex = 0, mirror2Index = 0, breakIndex = 0, stormIndex = 0, evolve2Index = 0, rushIndex = 0, multiIndex = 0, warIndex = 0, mergeIndex = 0, yinyangIndex = 0, fourthIndex = 0, ghostIndex = 0, enemyIndex = 0;
        
        const blessings = [
            { name: 'Velocidad', emoji: '', effect: 'speed' },
            { name: 'Tamao', emoji: '', effect: 'size' },
            { name: 'Sabidura', emoji: '', effect: 'wisdom' }
        ];
        
        const curses = [
            { name: 'SANGRE', color: '#f00', effect: 'blood' },
            { name: 'OSCURIDAD', color: '#000', effect: 'darkness' },
            { name: 'INVERSIN', color: '#f0f', effect: 'reverse' },
            { name: 'PESADILLA', color: '#400', effect: 'nightmare' }
        ];
        
        const mutations = [
            { name: 'BIFURCACIN', emoji: '', effect: 'bifurcation' },
            { name: 'ESPIRAL', emoji: '', effect: 'spiral' },
            { name: 'AMPLIFICADOR', emoji: '', effect: 'amplifier' },
            { name: 'INVISIBLE', emoji: '', effect: 'invisible' }
        ];
        
        const spirits = [
            { name: 'CANGREJO', emoji: '', effect: 'crab' },
            { name: 'ESCORPIN', emoji: '', effect: 'scorpion' },
            { name: 'DRAGN', emoji: '', effect: 'dragon' },
            { name: 'FANTASMA', emoji: '', effect: 'ghost' },
            { name: 'ROBOT', emoji: '', effect: 'robot' }
        ];
        
        const skinsData = {
            rainbow: { name: 'Arcoris', color: 'hsl' },
            fire: { name: 'Fuego', color: '#f00' },
            ice: { name: 'Hielo', color: '#0ff' },
            toxic: { name: 'Txico', color: '#0f0' },
            gold: { name: 'Oro', color: '#ffd700' },
            shadow: { name: 'Sombra', color: '#333' }
        };
        
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            const sounds = {
                eat: { freq: 800, dur: 0.1, type: 'sine' },
                power: { freq: 1200, dur: 0.2, type: 'square' },
                die: { freq: 200, dur: 0.5, type: 'sawtooth' },
                achievement: { freq: 1000, dur: 0.3, type: 'sine' },
                portal: { freq: 600, dur: 0.4, type: 'triangle' },
                boss: { freq: 100, dur: 0.8, type: 'sawtooth' },
                meteor: { freq: 150, dur: 0.3, type: 'square' }
            };
            
            const s = sounds[type] || sounds.eat;
            osc.frequency.setValueAtTime(s.freq, audioCtx.currentTime);
            osc.type = s.type;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + s.dur);
            osc.start();
            osc.stop(audioCtx.currentTime + s.dur);
        }
        
        let snakeMessages = [
            "Vamos, movete!",
            "Me vas a hacer chocar?",
            "Tengo mal presentimiento...",
            "Ms rpido!",
            "Me gusta este poder",
            "Por qu soy verde?",
            "Creo que vi un portal",
            "CUIDADO",
            "Eso fue cerca!",
            "* bosteza *",
            "Pods dejar de morir?",
            "Otra vez? Qu aburrido",
            "Mi vida tiene sentido?",
            "El vaco me da miedo",
            "Vi algo en el espejo...",
            "Soy real?",
            "A veces me pregunto si soy la buena",
            "Escape click: " + escapeClicks,
            "Mi cola me hace cosquillas",
            "SCREAM?"
        ];
        
        let gameDiaryTips = [
            "El vaco crece con tu score...",
            "3333 puntos = el OJO te observa",
            "K-O-N-A-M-I = vidas infinitas",
            "A-B-R-A-C-A-D-A-B-R-A = arcoris",
            "10 clicks en ESC = ???",
            "Eleg 'No' al morir para ver algo",
            "El modo Dios te espera en 7777",
            "Los portales te llevan a otras dimensiones",
            "La snake tejudica cuando mors mucho",
            "Hay 10 logros secretos"
        ];
        
        function init() {
            snake = [
                { x: 10, y: 10 },
                { x: 9, y: 10 },
                { x: 8, y: 10 }
            ];
            direction = { x: 1, y: 0 };
            nextDirection = { x: 1, y: 0 };
            score = 0;
            combo = 1;
            isGameOver = false;
            isPaused = false;
            gameSpeed = 100;
            specialFoods = [];
            portals = [];
            particles = [];
            events = { inverted: false, ghost: false, void: false, voidLevel: 0 };
            powers = {
                invincible: { active: false, timer: 0 },
                x2: { active: false, timer: 0 },
                slow: { active: false, timer: 0 },
                short: { active: false, timer: 0 }
            };
            eventTimer = 0;
            nextEventIn = Math.random() * 15000 + 15000;
            eyeActive = false;
            eyeFreeze = false;
            document.getElementById('eye').classList.remove('show');
            document.body.classList.remove('god-mode');
            playSessionStart = Date.now();
            spawnFood();
            updateUI();
            showMessage("BUENA SUERTE! Score anterior: " + (localStorage.getItem('lastScore') || 0));
            localStorage.setItem('lastScore', score);
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(update, gameSpeed);
        }
        
        function spawnFood() {
            food = {
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT)
            };
            snake.forEach(s => {
                if (s.x === food.x && s.y === food.y) spawnFood();
            });
        }
        
        function spawnSpecialFood() {
            const types = [
                { type: 'invincible', color: '#00f', emoji: '' },
                { type: 'x2', color: '#ff0', emoji: '' },
                { type: 'slow', color: '#f00', emoji: '' },
                { type: 'short', color: '#90f', emoji: '' }
            ];
            const type = types[Math.floor(Math.random() * types.length)];
            const pos = {
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT),
                ...type
            };
            specialFoods.push(pos);
            if (specialFoods.length > 3) specialFoods.shift();
        }
        
        function spawnPortal() {
            const dimensions = [
                { name: 'INVERTIDA', effect: 'inverted', color: '#f0f' },
                { name: '8-BIT', effect: '8bit', color: '#0f0' },
                { name: 'INFERNO', effect: 'inferno', color: '#f00' },
                { name: 'FRO', effect: 'cold', color: '#0ff' }
            ];
            const dim = dimensions[Math.floor(Math.random() * dimensions.length)];
            portals.push({
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT),
                ...dim,
                timer: 100
            });
        }
        
        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x * GRID + GRID / 2,
                    y: y * GRID + GRID / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1,
                    color: color
                });
            }
        }
        
        function update() {
            if (isPaused || isGameOver) return;
            
            aiAutoPlay();
            
            if (foodMode) {
                return;
            }
            
            direction = events.inverted ? 
                { x: -nextDirection.x, y: -nextDirection.y } : nextDirection;
            
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
            
            if (spirit === 'dragon') {
                if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                    direction = { x: -direction.x, y: -direction.y };
                    nextDirection = direction;
                    head.x = snake[0].x + direction.x;
                    head.y = snake[0].y + direction.y;
                }
            } else {
                if (head.x < 0) head.x = TILE_COUNT - 1;
                if (head.x >= TILE_COUNT) head.x = 0;
                if (head.y < 0) head.y = TILE_COUNT - 1;
                if (head.y >= TILE_COUNT) head.y = 0;
            }
            
            let collision = false;
            for (let i = 0; i < snake.length - 1; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    collision = true;
                    break;
                }
            }
            
            if (collision && !powers.invincible.active && !events.ghost) {
                gameOver();
                return;
            }
            
            snake.unshift(head);
            
            if (head.x === food.x && head.y === food.y) {
                const now = Date.now();
                if (now - lastEatTime < 2000) {
                    combo = Math.min(combo + 1, 10);
                } else {
                    combo = 1;
                }
                lastEatTime = now;
                
                const points = powers.x2.active ? 20 * combo : 10 * combo;
                score += points;
                createParticles(food.x, food.y, '#ff0');
                playSound('eat');
                spawnFood();
                updateUI();
                checkAchievements();
                
                if (score > 0 && score % 100 === 0) spawnSpecialFood();
                if (score > 0 && score % 300 === 0 && !achievements.powerUser.unlocked) {
                    achievements.powerUser.unlocked = true;
                    showAchievement(" Adicto a los poderes!");
                }
            } else {
                let ateSpecial = false;
                specialFoods.forEach((sf, i) => {
                    if (head.x === sf.x && head.y === sf.y) {
                        activatePower(sf.type);
                        playSound('power');
                        specialFoods.splice(i, 1);
                        ateSpecial = true;
                        score += 50;
                        createParticles(head.x, head.y, sf.color, 20);
                    }
                });
                
                if (!ateSpecial) {
                    snake.pop();
                }
            }
            
            portals.forEach((p, i) => {
                if (head.x === p.x && head.y === p.y) {
                    activateDimension(p.effect);
                    playSound('portal');
                    portals.splice(i, 1);
                    if (!achievements.portalSurvivor.unlocked) {
                        achievements.portalSurvivor.unlocked = true;
                        showAchievement(" Sobreviviente Dimensional!");
                    }
                }
            });
            
            if (powers.short.active && snake.length > 5) {
                snake.pop();
            }
            
            if (spirit === 'scorpion' && snake.length > 3) {
                const tail = snake[snake.length - 1];
                mines.push({ x: tail.x, y: tail.y, timer: 50 });
            }
            
            mines.forEach((m, i) => {
                m.timer--;
                if (m.timer <= 0) {
                    mines.splice(i, 1);
                } else if (head.x === m.x && head.y === m.y) {
                    if (!powers.invincible.active) {
                        createParticles(head.x, head.y, '#f00', 30);
                        playSound('meteor');
                        if (lives > 1) {
                            lives--;
                            document.getElementById('lives').textContent = "".repeat(lives);
                            showMessage("Pisaste una mina! -1 vida");
                            init();
                            return;
                        } else {
                            gameOver();
                            return;
                        }
                    }
                }
            });
            
            if (spirit === 'robot') {
                iaScore++;
                if (iaScore % 100 === 0) {
                    document.getElementById('multiplayerScore').textContent = " IA: " + iaScore;
                }
            }
            
            if (score >= 9999 && !creditsPlayed) {
                creditsPlayed = true;
                showCredits();
            }
            
            if (mutation) {
                mutationTimer -= 100;
                if (mutationTimer <= 0) {
                    mutation = null;
                    document.getElementById('spiritIndicator').textContent = '';
                }
                
                if (mutation === 'bifurcation' && score > 0 && score % 200 === 0) {
                    snake.unshift({ ...snake[0] });
                    createParticles(snake[0].x, snake[0].y, '#0ff', 15);
                }
                
                if (mutation === 'amplifier') {
                    score += 1;
                }
            }
            
            clones.forEach((clone, i) => {
                clone.timer--;
                if (clone.timer <= 0) {
                    clones.splice(i, 1);
                    return;
                }
                
                const head = { x: clone.snake[0].x + clone.direction.x, y: clone.snake[0].y + clone.direction.y };
                
                if (head.x < 0) head.x = TILE_COUNT - 1;
                if (head.x >= TILE_COUNT) head.x = 0;
                if (head.y < 0) head.y = TILE_COUNT - 1;
                if (head.y >= TILE_COUNT) head.y = 0;
                
                clone.snake.unshift(head);
                if (head.x !== food.x || head.y !== food.y) {
                    clone.snake.pop();
                }
                
                if (head.x === food.x && head.y === food.y) {
                    score += 5;
                }
            });
            
            if (finalBoss && score > 0 && score % 50 === 0) {
                damageBoss(10);
            }
            
            if (score >= 5000 && !finalBoss && score < 15000) {
                if (Math.random() < 0.001) {
                    applyCurse();
                }
            }
            
            if (score >= 15000 && !finalBoss) {
                activateEndgame();
            }
            
            if (score > 0 && score % 100 === 0) {
                evolution++;
                if (evolution >= 100 && evolutionStage < 5) {
                    activateEvolution();
                }
            }
            
            gravityZones.forEach((zone, i) => {
                zone.timer--;
                if (zone.timer <= 0) {
                    gravityZones.splice(i, 1);
                    return;
                }
                
                const head = snake[0];
                const dist = Math.abs(head.x - zone.x) + Math.abs(head.y - zone.y);
                
                if (dist < 5) {
                    if (zone.type === 'attract') {
                        if (head.x < zone.x) direction.x = 1;
                        else if (head.x > zone.x) direction.x = -1;
                        if (head.y < zone.y) direction.y = 1;
                        else if (head.y > zone.y) direction.y = -1;
                    } else {
                        if (head.x < zone.x) direction.x = -1;
                        else if (head.x > zone.x) direction.x = 1;
                        if (head.y < zone.y) direction.y = -1;
                        else if (head.y > zone.y) direction.y = 1;
                    }
                    nextDirection = direction;
                }
            });
            
            if (quantumSnake.length > 0 && score % 50 === 0) {
                quantumSnake = [];
                for (let i = 0; i < 3; i++) {
                    quantumSnake.push({
                        x: snake[0].x + (Math.random() - 0.5) * 5,
                        y: snake[0].y + (Math.random() - 0.5) * 5
                    });
                }
            }
            
            if (dualMode) {
                const head2 = { x: snake2[0].x + direction2.x, y: snake2[0].y + direction2.y };
                if (head2.x < 0) head2.x = TILE_COUNT - 1;
                if (head2.x >= TILE_COUNT) head2.x = 0;
                if (head2.y < 0) head2.y = TILE_COUNT - 1;
                if (head2.y >= TILE_COUNT) head2.y = 0;
                snake2.unshift(head2);
                
                if (head2.x === food.x && head2.y === food.y) {
                    iaScore += 10;
                    document.getElementById('multiplayerScore').textContent = " P2: " + iaScore;
                    spawnFood();
                } else {
                    snake2.pop();
                }
            }
            
            updatePowers();
            updateEvents();
            render();
        }
        
        function activatePower(type) {
            if (type === 'invincible') {
                powers.invincible = { active: true, timer: 5000 };
            } else if (type === 'x2') {
                powers.x2 = { active: true, timer: 10000 };
            } else if (type === 'slow') {
                powers.slow = { active: true, timer: 5000 };
                gameSpeed = 150;
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
            } else if (type === 'short') {
                powers.short = { active: true, timer: 5000 };
            }
            updatePowerUI();
        }
        
        function updatePowers() {
            Object.keys(powers).forEach(key => {
                if (powers[key].active) {
                    powers[key].timer -= 100;
                    if (powers[key].timer <= 0) {
                        powers[key].active = false;
                        if (key === 'slow') {
                            gameSpeed = 100;
                            clearInterval(gameLoop);
                            gameLoop = setInterval(update, gameSpeed);
                        }
                    }
                }
            });
            updatePowerUI();
        }
        
        function updateEvents() {
            eventTimer += 100;
            
            if (score >= 500 && !boss && Math.random() < 0.001) {
                spawnBoss();
            }
            
            if (boss) {
                bossHealth -= 0.5;
                document.getElementById('bossBarFill').style.width = bossHealth + '%';
                if (bossHealth <= 0) {
                    killBoss();
                }
            }
            
            if (score > 0 && score % 200 === 0 && score < 3000 && Math.random() < 0.3) {
                spawnMeteor();
            }
            
            meteoritos.forEach((m, i) => {
                m.timer--;
                m.y += 8;
                if (m.y > canvas.height) {
                    meteoritos.splice(i, 1);
                } else {
                    const hitX = Math.floor(m.x / GRID);
                    const hitY = Math.floor(m.y / GRID);
                    if (hitX === snake[0].x && hitY === snake[0].y) {
                        if (!powers.invincible.active && !events.ghost) {
                            meteoritos.splice(i, 1);
                            playSound('meteor');
                            flashScreen();
                            if (lives > 1) {
                                lives--;
                                document.getElementById('lives').textContent = "".repeat(lives);
                                showMessage("Meteorito! -" + lives + " vidas");
                                init();
                                return;
                            } else {
                                gameOver();
                            }
                        }
                    }
                }
            });
            
            if (chaosMode && Math.random() < 0.1) {
                triggerRandomEvent();
            }
            
            if (eventTimer >= nextEventIn && score > 100) {
                triggerRandomEvent();
                eventTimer = 0;
                nextEventIn = Math.random() * 15000 + 15000;
            }
            
            if (score >= 1000 && !events.void) {
                events.void = true;
                events.voidLevel = 1;
                document.getElementById('voidEffect').classList.add('active');
                showEvent(" EL VACO SE ACERCA ");
            }
            
            if (events.void) {
                events.voidLevel = Math.floor(score / 1000);
            }
            
            if (score >= 3333 && !eyeActive) {
                eyeActive = true;
                document.getElementById('eye').classList.add('show');
                showEvent(" EL OJO TE OBSERVA ");
            }
            
            if (eyeActive && !achievements.eyeSurvivor.unlocked) {
                const eye = document.getElementById('eye');
                const snakeHead = snake[0];
                const eyeX = eye.offsetLeft + 30;
                const eyeY = eye.offsetTop + 30;
                const snakeX = snakeHead.x * GRID + GRID/2 + canvas.offsetLeft;
                const snakeY = snakeHead.y * GRID + GRID/2 + canvas.offsetTop;
                
                const dist = Math.sqrt(Math.pow(eyeX - snakeX, 2) + Math.pow(eyeY - snakeY, 2));
                
                eye.style.left = (Math.random() * (window.innerWidth - 100)) + 'px';
                eye.style.top = (Math.random() * (window.innerHeight - 100)) + 'px';
                
                if (dist < 100 && !eyeFreeze) {
                    eyeFreeze = true;
                    showEvent(" TE VI! FREEZE!");
                    isPaused = true;
                    setTimeout(() => {
                        isPaused = false;
                        eyeFreeze = false;
                    }, 2000);
                }
                
                if (score >= 4000 && !achievements.eyeSurvivor.unlocked) {
                    achievements.eyeSurvivor.unlocked = true;
                    showAchievement(" Sobreviviste al Ojo!");
                }
            }
            
            if (score >= 7777) {
                document.body.classList.add('god-mode');
                if (!achievements.godMode.unlocked) {
                    showAchievement(" MODO DIOS ACTIVADO!");
                }
            }
            
            portals.forEach(p => {
                p.timer--;
                if (p.timer <= 0) {
                    portals = portals.filter(x => x !== p);
                }
            });
            
            if (Math.random() < 0.005 && score > 50) {
                showMessage(snakeMessages[Math.floor(Math.random() * snakeMessages.length)]);
            }
            
            if (!dailyChallenge) {
                checkDailyChallenge();
            }
        }
        
        function spawnBoss() {
            const bosses = [
                { name: 'ASTEROIDE GIGANTE', hp: 100, emoji: '' },
                { name: 'ROBOT DEFENSOR', hp: 150, emoji: '' },
                { name: 'ALIEN REBELDE', hp: 120, emoji: '' }
            ];
            boss = bosses[Math.floor(Math.random() * bosses.length)];
            bossHealth = boss.hp;
            document.getElementById('bossName').textContent = boss.emoji + ' ' + boss.name + ' ' + boss.emoji;
            document.getElementById('bossName').classList.add('show');
            document.getElementById('bossBar').classList.add('show');
            showEvent(" JEFE APARECI!");
            showAchievement(" Encontraste un JEFE!");
            playSound('boss');
        }
        
        function killBoss() {
            score += 500;
            boss = null;
            document.getElementById('bossName').classList.remove('show');
            document.getElementById('bossBar').classList.remove('show');
            showEvent(" JEFE DERROTADO! +500 pts");
            showAchievement(" Matastre al JEFE!");
            playSound('achievement');
            flashScreen();
        }
        
        function spawnMeteor() {
            const x = Math.random() * canvas.width;
            meteoritos.push({ x: x, y: -30, timer: 100 });
            const el = document.createElement('div');
            el.className = 'meteor';
            el.textContent = '';
            el.style.left = x + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 2000);
        }
        
        function flashScreen() {
            const flash = document.getElementById('screenFlash');
            flash.classList.add('flash');
            setTimeout(() => flash.classList.remove('flash'), 200);
        }
        
        function showCredits() {
            const overlay = document.getElementById('creditsOverlay');
            overlay.innerHTML = `
                <div class="credit-title">SNAKE ULTRA</div>
                <div class="credit-line">Un juego por vos</div>
                <div class="credit-line">Score final: ${score}</div>
                <div class="credit-line">Muertes: ${deathCount}</div>
                <div class="credit-line">Tiempo: ${totalPlayTime}s</div>
                <div class="credit-line" style="margin-top: 50px;">Programacin</div>
                <div class="credit-line"> opencode + vos</div>
                <div class="credit-line" style="margin-top: 50px;">Arte</div>
                <div class="credit-line">La snake</div>
                <div class="credit-line" style="margin-top: 50px;">Msica</div>
                <div class="credit-line">Beep boop</div>
                <div class="credit-line" style="margin-top: 50px;">Gracias por jugar</div>
                <div class="credit-line">Ahora el juego continua...</div>
                <div class="credits-skip">ESC para salir</div>
            `;
            overlay.classList.add('show');
            playSound('achievement');
            setTimeout(() => {
                overlay.classList.remove('show');
                activateGodMode();
            }, 10000);
        }
        
        function activateGodMode() {
            score = 10000;
            gameSpeed = 30;
            clearInterval(gameLoop);
            gameLoop = setInterval(update, gameSpeed);
            showEvent(" MODO GOD ACTIVADO");
            showAchievement(" MODO INFINITO!");
            powers.invincible.active = true;
            powers.x2.active = true;
        }
        
        function updateMinimap() {
            if (!showMinimap) return;
            const minimap = document.getElementById('minimap');
            minimap.innerHTML = '';
            snake.forEach(s => {
                const dot = document.createElement('div');
                dot.className = 'minimap-snake';
                dot.style.left = (s.x / TILE_COUNT * 100) + '%';
                dot.style.top = (s.y / TILE_COUNT * 100) + '%';
                minimap.appendChild(dot);
            });
            const foodDot = document.createElement('div');
            foodDot.className = 'minimap-food';
            foodDot.style.left = (food.x / TILE_COUNT * 100) + '%';
            foodDot.style.top = (food.y / TILE_COUNT * 100) + '%';
            minimap.appendChild(foodDot);
        }
        
        function activateSpirit(spiritName) {
            spirit = spiritName;
            const spiritData = spirits.find(s => s.effect === spiritName);
            document.getElementById('spiritIndicator').textContent = spiritData.emoji + ' ' + spiritData.name;
            showEvent(spiritData.emoji + ' ' + spiritData.name + '!');
            playSound('achievement');
        }
        
        function activateMutation() {
            mutation = mutations[Math.floor(Math.random() * mutations.length)];
            mutationTimer = 15000;
            document.getElementById('spiritIndicator').textContent = mutation.emoji + ' ' + mutation.name;
            showEvent(mutation.emoji + ' ' + mutation.name + '!');
            playSound('achievement');
        }
        
        function buyItem(item, cost) {
            if (score >= cost) {
                score -= cost;
                updateUI();
                if (item === 'invincible') {
                    powers.invincible.active = true;
                    powers.invincible.timer = 5000;
                } else if (item === 'x2') {
                    powers.x2.active = true;
                    powers.x2.timer = 10000;
                } else if (item === 'slow') {
                    powers.slow.active = true;
                    powers.slow.timer = 5000;
                    gameSpeed = 150;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(update, gameSpeed);
                } else if (item === 'extraLife') {
                    lives++;
                    document.getElementById('lives').textContent = "".repeat(lives);
                } else if (item === 'shrink') {
                    while (snake.length > 5) snake.pop();
                }
                playSound('power');
                showMessage("Comprado!");
            } else {
                showMessage("No tens suficientes puntos!");
            }
        }
        
        function spawnHacker() {
            const hacker = {
                x: Math.random() * TILE_COUNT,
                y: Math.random() * TILE_COUNT,
                emoji: ['', '', ''][Math.floor(Math.random() * 3)],
                timer: 100
            };
            hackers.push(hacker);
        }
        
        function timeTravel() {
            const flash = document.getElementById('timeTravelFlash');
            flash.classList.add('active');
            setTimeout(() => flash.classList.remove('active'), 1000);
            
            const retroScore = Math.floor(score * 0.8);
            score = retroScore;
            combo = 1;
            specialFoods = [];
            portals = [];
            mines = [];
            playSound('portal');
            showEvent(" VIAJ AL PASADO!");
            showMessage("Score reduci a " + retroScore);
            updateUI();
        }
        
        function triggerRealityFracture() {
            realityFracture = true;
            document.getElementById('realityFracture').classList.add('active');
            showEvent(" FRACTURA DE REALIDAD!");
            setTimeout(() => {
                realityFracture = false;
                document.getElementById('realityFracture').classList.remove('active');
            }, 5000);
            playSound('boss');
        }
        
        function showBlessingPanel() {
            document.getElementById('blessingPanel').classList.add('show');
        }
        
        function chooseBlessing(type) {
            document.getElementById('blessingPanel').classList.remove('show');
            blessingActive = type;
            
            if (type === 'speed') {
                gameSpeed = 50;
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
                showAchievement(" BENDICIN DE VELOCIDAD!");
            } else if (type === 'size') {
                while (snake.length < 15) {
                    snake.push({ ...snake[snake.length - 1] });
                }
                showAchievement(" BENDICIN DE TAMAO!");
            } else if (type === 'wisdom') {
                powers.invincible.active = true;
                powers.invincible.timer = 15000;
                powers.x2.active = true;
                powers.x2.timer = 20000;
                showAchievement(" BENDICIN DE SABIDURA!");
            }
            playSound('achievement');
        }
        
        function closeBlessing() {
            document.getElementById('blessingPanel').classList.remove('show');
            showMessage("Destino rechazado...");
        }
        
        function applyCurse() {
            curse = curses[Math.floor(Math.random() * curses.length)];
            const overlay = document.getElementById('curseOverlay');
            overlay.style.background = curse.color;
            overlay.classList.add('show');
            
            if (curse.effect === 'blood') {
                document.body.style.filter = 'hue-rotate(180deg) saturate(2)';
            } else if (curse.effect === 'darkness') {
                canvas.style.filter = 'brightness(0.3)';
            } else if (curse.effect === 'reverse') {
                events.inverted = true;
            } else if (curse.effect === 'nightmare') {
                glitchMode = true;
                document.body.classList.add('glitch-mode');
            }
            
            showEvent(" MALICIN: " + curse.name + "!");
            setTimeout(() => {
                overlay.classList.remove('show');
                document.body.style.filter = '';
                canvas.style.filter = '';
                events.inverted = false;
                glitchMode = false;
                document.body.classList.remove('glitch-mode');
                curse = null;
            }, 10000);
        }
        
        function activateInception() {
            inceptionLevel++;
            document.getElementById('inceptionLevel').classList.add('show');
            showEvent(" INCEPTION nivel " + inceptionLevel + "!");
            playSound('portal');
            
            if (inceptionLevel >= 3) {
                showAchievement(" SUEO PROFUNDO!");
                gameSpeed = 30;
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
            }
        }
        
        function spawnClone() {
            const clone = {
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT),
                snake: [
                    { x: clone.x, y: clone.y },
                    { x: clone.x - 1, y: clone.y },
                    { x: clone.x - 2, y: clone.y }
                ],
                direction: { x: 1, y: 0 },
                timer: 200
            };
            clones.push(clone);
        }
        
        function activateEndgame() {
            finalBoss = {
                name: 'EL JUEGO',
                health: 1000
            };
            finalBossHealth = 1000;
            document.getElementById('finalBoss').classList.add('show');
            showEvent(" BOSS FINAL!");
            showAchievement(" LLEG EL FINAL!");
            playSound('boss');
        }
        
        function damageBoss(amount) {
            if (!finalBoss) return;
            finalBossHealth -= amount;
            document.getElementById('bossHealthFill').style.width = (finalBossHealth / 10) + '%';
            
            if (finalBossHealth <= 0) {
                document.getElementById('finalBoss').classList.remove('show');
                showEvent(" DERROTASTE AL JUEGO!");
                showAchievement(" VICTORIA DEFINITIVA!");
                score += 5000;
                finalBoss = null;
                playSound('achievement');
                flashScreen();
            }
        }
        
        function toggleLiquidMode() {
            liquidMode = !liquidMode;
            document.body.classList.toggle('liquid-mode', liquidMode);
            showAchievement(liquidMode ? " MODO LQUIDO!" : " Lquido solidificado");
            playSound('power');
        }
        
        function toggleVirusMode() {
            virusMode = !virusMode;
            document.getElementById('virusOverlay').classList.toggle('active', virusMode);
            
            if (virusMode) {
                const viruses = ['', '', '', '', ''];
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const v = document.createElement('div');
                        v.textContent = viruses[Math.floor(Math.random() * viruses.length)];
                        v.style.position = 'fixed';
                        v.style.left = Math.random() * 100 + 'vw';
                        v.style.top = Math.random() * 100 + 'vh';
                        v.style.fontSize = '30px';
                        v.style.animation = 'stickerFloat 2s infinite';
                        v.style.zIndex = '100';
                        document.body.appendChild(v);
                    }, i * 200);
                }
                showAchievement(" MODO VIRUS!");
            }
            playSound('boss');
        }
        
        function toggleAutoPlay() {
            autoPlay = !autoPlay;
            document.getElementById('autoPlayIndicator').classList.toggle('show', autoPlay);
            showMessage(autoPlay ? " La IA juega por vos" : " Volvs a jugar vos");
            playSound('achievement');
        }
        
        function toggleMirrorDimension() {
            mirrorDimension = !mirrorDimension;
            document.getElementById('mirrorDimension').classList.toggle('show', mirrorDimension);
            showMessage(mirrorDimension ? " Dimensin espejo activada" : " Espejo ocultado");
            playSound('portal');
        }
        
        function activateQuantum() {
            quantumSnake = [];
            for (let i = 0; i < 3; i++) {
                quantumSnake.push({
                    x: snake[0].x + (Math.random() - 0.5) * 5,
                    y: snake[0].y + (Math.random() - 0.5) * 5
                });
            }
            showEvent(" SUPERPOSICIN CUNTICA!");
            showAchievement(" Snake en mltiples estados!");
            playSound('portal');
        }
        
        function spawnGravityZone() {
            const zone = {
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT),
                type: Math.random() > 0.5 ? 'attract' : 'repel',
                timer: 150
            };
            gravityZones.push(zone);
            showEvent(zone.type === 'attract' ? " ZONA DE ATRACCIN!" : " ZONA DE REPULSIN!");
        }
        
        function activateFoodMode() {
            foodMode = !foodMode;
            document.body.classList.toggle('food-mode', foodMode);
            showMessage(foodMode ? " Ahora controls la COMIDA" : " Volvs a ser la snake");
            playSound('power');
        }
        
        function activateEvolution() {
            evolutionStage++;
            evolution = 0;
            
            const forms = ['', '', '', '', ''];
            showEvent(forms[evolutionStage % forms.length] + " EVOLUCIONA!");
            
            if (evolutionStage >= 5) {
                showAchievement(" FORMA ESTELAR!");
                powers.invincible.active = true;
                powers.invincible.timer = 30000;
            }
            playSound('achievement');
        }
        
        function activateGodView() {
            godViewActive = !godViewActive;
            document.getElementById('godView').classList.toggle('show', godViewActive);
            
            if (godViewActive) {
                setTimeout(() => {
                    document.getElementById('godView').classList.remove('show');
                    showMessage("El universo te rechaza");
                }, 5000);
            }
            playSound('boss');
        }
        
        function spawnSticker() {
            const stickersEmojis = ['', '', '', '', '', '', '', ''];
            const sticker = document.createElement('div');
            sticker.className = 'sticker';
            sticker.textContent = stickersEmojis[Math.floor(Math.random() * stickersEmojis.length)];
            sticker.style.left = Math.random() * 80 + 10 + '%';
            sticker.style.top = Math.random() * 60 + 20 + '%';
            document.body.appendChild(sticker);
            stickers.push(sticker);
            
            if (stickers.length > 20) {
                const old = stickers.shift();
                old.remove();
            }
        }
        
        function activateTunnel() {
            infiniteTunnel = !infiniteTunnel;
            document.getElementById('infiniteTunnel').classList.toggle('show', infiniteTunnel);
            showAchievement(infiniteTunnel ? " TNEL INFINITO!" : " Saliste del tnel");
            playSound('portal');
        }
        
        function activateDreamMode() {
            dreamMode = !dreamMode;
            document.getElementById('dreamLayer').classList.toggle('show', dreamMode);
            showEvent(dreamMode ? " MODO SUEO!" : " Despertaste");
            playSound('portal');
        }
        
        function activatePixelStorm() {
            pixelStorm = !pixelStorm;
            document.getElementById('pixelStorm').classList.toggle('active', pixelStorm);
            if (pixelStorm) {
                document.getElementById('pixelStorm').style.background = `
                    repeating-linear-gradient(0deg, 
                    transparent, transparent 2px, 
                    rgba(${Math.random()*255},${Math.random()*255},${Math.random()*255},0.3) 2px, 
                    rgba(${Math.random()*255},${Math.random()*255},${Math.random()*255},0.3) 4px)`;
            }
            showAchievement(pixelStorm ? " TORMENTA DE PXELES!" : " Tormenta calmada");
            playSound('boss');
        }
        
        function activateHackerMode() {
            hackerMode = !hackerMode;
            document.getElementById('hackerTerminal').classList.toggle('show', hackerMode);
            
            if (hackerMode) {
                const terminal = document.getElementById('hackerText');
                const messages = [
                    "> Accediendo al mainframe...",
                    "> Bypass de seguridad...",
                    "> Modificando score...",
                    "> Contrasea: SNAKE_ULTRA",
                    "> Acceso root concedido"
                ];
                let i = 0;
                const interval = setInterval(() => {
                    if (i >= messages.length) {
                        clearInterval(interval);
                        return;
                    }
                    terminal.innerHTML += '<div>' + messages[i] + '</div>';
                    i++;
                }, 500);
                score += 1000;
                updateUI();
            }
            playSound('achievement');
        }
        
        function activateJokerMode() {
            jokerMode = !jokerMode;
            document.getElementById('jokerLaugh').classList.toggle('show', jokerMode);
            if (jokerMode) {
                setTimeout(() => {
                    document.getElementById('jokerLaugh').classList.remove('show');
                    showMessage("Por qu tan serio?");
                }, 2000);
            }
            playSound('boss');
        }
        
        function toggleChat() {
            chatActive = !chatActive;
            document.getElementById('chatOverlay').classList.toggle('show', chatActive);
            
            if (chatActive) {
                const messages = [
                    " [Global] Jugador: Buena suerte!",
                    " [Global] Unknown: Este juego es loco",
                    " [Global] SnakeMaster: Alguien lleg al boss?",
                    " [Global] Jugador: Help! Maldicin activa!",
                    " [Global] Unknown: JAJJAJA"
                ];
                let i = 0;
                const chatInterval = setInterval(() => {
                    if (!chatActive || i >= messages.length) {
                        clearInterval(chatInterval);
                        return;
                    }
                    document.getElementById('chatOverlay').textContent = messages[i];
                    i++;
                }, 2000);
            }
        }
        
        function activateBloodMoon() {
            bloodMoon = !bloodMoon;
            document.getElementById('bloodMoon').classList.toggle('show', bloodMoon);
            if (bloodMoon) {
                document.body.style.filter = 'sepia(1) hue-rotate(-50deg) saturate(2)';
            } else {
                document.body.style.filter = '';
            }
            showAchievement(bloodMoon ? " LUNA DE SANGRE!" : " Amaneci");
            playSound('boss');
        }
        
        function summonVoidEntity() {
            voidEntity = !voidEntity;
            document.getElementById('voidEntity').classList.toggle('show', voidEntity);
            
            if (voidEntity) {
                setTimeout(() => {
                    document.getElementById('voidEntity').classList.remove('show');
                    score = 0;
                    showMessage("El Vaco consumi todo...");
                    flashScreen();
                }, 3000);
            }
            playSound('boss');
        }
        
        function activateRandomizer() {
            randomizerMode = !randomizerMode;
            const randomizer = document.getElementById('randomizer');
            randomizer.classList.toggle('show', randomizerMode);
            
            if (randomizerMode) {
                const emojis = ['', '', '', '', '', '', '', ''];
                let i = 0;
                const interval = setInterval(() => {
                    if (!randomizerMode) {
                        clearInterval(interval);
                        return;
                    }
                    randomizer.textContent = emojis[i % emojis.length];
                    i++;
                }, 200);
                
                setTimeout(() => {
                    randomizerMode = false;
                    randomizer.classList.remove('show');
                    const bonus = [100, 200, 500, -100, -200, 1000][Math.floor(Math.random() * 6)];
                    score += bonus;
                    showMessage(bonus > 0 ? "Ganaste " + bonus + " pts!" : "Perdiste " + Math.abs(bonus) + " pts");
                    updateUI();
                }, 5000);
            }
            playSound('achievement');
        }
        
        function activateDimensionRift() {
            dimensionRift = !dimensionRift;
            document.getElementById('dimensionRip').classList.toggle('active', dimensionRift);
            
            if (dimensionRift) {
                const effects = ['invertida', '8bit', 'inferno', 'cold'];
                const randomEffect = effects[Math.floor(Math.random() * effects.length)];
                activateDimension(randomEffect);
                setTimeout(() => {
                    dimensionRift = false;
                    document.getElementById('dimensionRip').classList.remove('active');
                }, 3000);
            }
            playSound('portal');
        }
        
        function activateParadox() {
            paradoxMode = !paradoxMode;
            showEvent(paradoxMode ? " PARADOJA TEMPORAL!" : " Paradoja resuelta");
            
            if (paradoxMode) {
                const originalScore = score;
                score = Math.floor(score * 1.5);
                showMessage("El futuro mejora tu score: " + originalScore + "  " + score);
                setTimeout(() => {
                    paradoxMode = false;
                }, 5000);
            }
            playSound('boss');
        }
        
        function activateNightmare() {
            nightmareMode = !nightmareMode;
            
            if (nightmareMode) {
                document.body.style.animation = 'neonFlicker 0.1s infinite';
                showEvent(" PESADILLA! SUEO LCIDO!");
                
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const flash = document.getElementById('traumaFlash');
                        flash.classList.add('active');
                        setTimeout(() => flash.classList.remove('active'), 100);
                    }, i * 300);
                }
                
                setTimeout(() => {
                    nightmareMode = false;
                    document.body.style.animation = '';
                    showMessage("Despertaste sudando...");
                }, 5000);
            }
            playSound('die');
        }
        
        function triggerTrueEnding() {
            trueEnding = true;
            
            const overlays = [
                document.getElementById('voidEffect'),
                document.getElementById('realityFracture'),
                document.getElementById('dreamLayer'),
                document.getElementById('bloodMoon')
            ];
            
            overlays.forEach(o => o.classList.add('active'));
            
            showEvent(" VERDADERO FINAL!");
            showAchievement(" TRUE ENDING!");
            
            setTimeout(() => {
                alert(" FELICIDADES! COMPLETASTE EL VERDADERO FINAL DE SNAKE ULTRA!\n\nGracias por jugar esta locura de " + (localStorage.getItem('snakeDeaths') || 0) + " muertes.");
                overlays.forEach(o => o.classList.remove('active'));
                trueEnding = false;
            }, 5000);
            
            playSound('achievement');
            flashScreen();
        }
        
        function whisper() {
            const whispers = [
                "Alguna vez te preguntaste si la snake es real?",
                "El vaco te observa desde score 1000...",
                "3333 puntos = el OJO aparece",
                "9999 puntos = los crditos",
                "15000 puntos = el Boss Final",
                "Sos solo una snake en un juego...",
                "Qu pasa si mors 100 veces?",
                "El cdigo KONAMI te da poder infinito",
                "ABRACADABRA = arcoris",
                "CHAOS = eventos infinitos"
            ];
            const w = whispers[Math.floor(Math.random() * whispers.length)];
            showMessage(" " + w);
        }
        
        function activateOmnipresent() {
            omnipresentMode = !omnipresentMode;
            document.getElementById('omnipresent').classList.toggle('active', omnipresentMode);
            showAchievement(omnipresentMode ? " OMNIPRESENTE!" : " Ya no sos omnipresente");
            playSound('portal');
        }
        
        function activateChaosUniverse() {
            chaosUniverse = !chaosUniverse;
            document.getElementById('chaosUniverse').classList.toggle('active', chaosUniverse);
            if (chaosUniverse) {
                document.body.style.animation = 'neonFlicker 0.1s infinite';
            } else {
                document.body.style.animation = '';
            }
            showAchievement(chaosUniverse ? " CAOS UNIVERSAL!" : " Orden restaurada");
            playSound('boss');
        }
        
        function activateTimeFreeze() {
            timeFreeze = !timeFreeze;
            document.getElementById('timeFreeze').classList.toggle('active', timeFreeze);
            if (timeFreeze) {
                isPaused = true;
                showEvent(" TIEMPO CONGELADO!");
            } else {
                isPaused = false;
                showEvent(" TIEMPO REANUDADO!");
            }
            playSound('portal');
        }
        
        function triggerExistentialCrisis() {
            existentialMode = !existentialMode;
            const crisis = document.getElementById('existentialCrisis');
            crisis.classList.toggle('show', existentialMode);
            
            if (existentialMode) {
                const questions = [
                    "Realmente controls la snake?",
                    "O la snake te controla a vos?",
                    "Qu es real?",
                    "Es esto un juego o vos sos el juego?",
                    "Tu snake tiene vida propia...",
                    "Quin programa tus pensamientos?",
                    "Tens libre albedro?",
                    "El vaco te conoce por tu nombre...",
                    "Sos solo una funcin en un loop infinito...",
                    "Qu hay ms all del canvas?"
                ];
                let i = 0;
                const existInterval = setInterval(() => {
                    if (!existentialMode || i >= questions.length) {
                        clearInterval(existInterval);
                        existentialMode = false;
                        crisis.classList.remove('show');
                        return;
                    }
                    document.getElementById('existText').textContent = questions[i];
                    i++;
                }, 1500);
            }
            playSound('boss');
        }
        
        function activateCosmicHorror() {
            cosmicHorror = !cosmicHorror;
            document.getElementById('cosmicHorror').classList.toggle('active', cosmicHorror);
            
            if (cosmicHorror) {
                const eldritch = ['', '', '', '', '', '', ''];
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const e = document.createElement('div');
                        e.textContent = eldritch[Math.floor(Math.random() * eldritch.length)];
                        e.style.position = 'fixed';
                        e.style.left = Math.random() * 100 + 'vw';
                        e.style.top = Math.random() * 100 + 'vh';
                        e.style.fontSize = (30 + Math.random() * 50) + 'px';
                        e.style.zIndex = '100';
                        e.style.animation = 'quantumFloat 2s infinite';
                        document.body.appendChild(e);
                    }, i * 100);
                }
            }
            showAchievement(cosmicHorror ? " HORROR CSMICO!" : " Los antiguos duermen");
            playSound('boss');
        }
        
        function activateAscended() {
            ascendedMode = !ascendedMode;
            document.getElementById('ascendedMode').classList.toggle('active', ascendedMode);
            
            if (ascendedMode) {
                document.body.style.filter = 'brightness(1.5)';
                document.querySelector('h1').textContent = 'SNAKE OMNISCIENTE';
                document.querySelector('h1').style.color = '#fff';
            } else {
                document.body.style.filter = '';
                document.querySelector('h1').textContent = 'SNAKE ULTRA';
                document.querySelector('h1').style.color = '#0ff';
            }
            showAchievement(ascendedMode ? " MODO ASCENDIDO!" : " Descendiste");
            playSound('achievement');
        }
        
        function activateInfiniteGame() {
            infiniteGame = !infiniteGame;
            document.getElementById('infiniteGame').classList.toggle('active', infiniteGame);
            showAchievement(infiniteGame ? " JUEGO INFINITO!" : " El loop termin");
            playSound('portal');
        }
        
        function activateDeleteSelf() {
            deleteSelfMode = !deleteSelfMode;
            const del = document.getElementById('deleteSelf');
            del.classList.toggle('active', deleteSelfMode);
            
            if (deleteSelfMode) {
                setTimeout(() => {
                    del.classList.remove('active');
                    showMessage("...casi te borras del existence");
                }, 2000);
            }
            playSound('die');
        }
        
        function showMemories() {
            const panel = document.getElementById('memoriesPanel');
            panel.classList.toggle('show');
            
            const list = document.getElementById('memoriesList');
            list.innerHTML = '';
            
            if (memories.length === 0) {
                list.innerHTML = '<div class="memory-item">No hay memorias an...</div>';
            } else {
                memories.slice(0, 10).forEach(m => {
                    list.innerHTML += `<div class="memory-item">${m.date}: Score ${m.score} - ${m.event}</div>`;
                });
            }
            
            memories.push({
                date: new Date().toLocaleString(),
                score: score,
                event: finalBoss ? 'Boss Final' : (score > 10000 ? 'Sobrevivi' : 'Jug')
            });
            localStorage.setItem('snakeMemories', JSON.stringify(memories));
        }
        
        function showTutorial() {
            tutorialMode = true;
            tutorialStep = 0;
            const overlay = document.getElementById('tutorialOverlay');
            const text = document.getElementById('tutorialText');
            
            const steps = [
                " BIENVENIDO A SNAKE ULTRA",
                "Usa las FLECHAS para moverte",
                "Come la comida AMARILLA para sumar puntos",
                "Los PODERES aparecen cada 100 puntos",
                "Escrib 'KONAMI' para vidas infinitas",
                "'CHAOS' para modo catico",
                "'MATRIX' para modo hackerman",
                "'ENDGAME' en 15000 puntos para el boss",
                "BOA SUERTE! "
            ];
            
            function nextStep() {
                if (tutorialStep >= steps.length) {
                    overlay.classList.remove('show');
                    tutorialMode = false;
                    return;
                }
                text.textContent = steps[tutorialStep];
                tutorialStep++;
            }
            
            overlay.classList.add('show');
            nextStep();
            
            overlay.querySelector('button').onclick = nextStep;
        }
        
        function closeTutorial() {
            document.getElementById('tutorialOverlay').classList.remove('show');
            tutorialMode = false;
        }
        
        function toggleCheatPanel() {
            document.getElementById('cheatPanel').classList.toggle('show');
        }
        
        function runCheat(code) {
            const keyMap = {
                'KONAMI': () => { lives = 99; powers.invincible.active = true; document.getElementById('lives').textContent = "".repeat(99); showAchievement(" KONAMI!"); },
                'ABRACADABRA': () => { rainbowMode = true; document.body.classList.add('rainbow-mode'); showAchievement(" ARCORIS!"); },
                'CHAOS': () => { chaosMode = !chaosMode; document.body.classList.toggle('chaos-mode'); showAchievement(chaosMode ? " CAOS!" : " Caos off"); },
                'METEOR': () => { for (let i = 0; i < 5; i++) setTimeout(() => spawnMeteor(), i * 500); showEvent(" LLUVIA!"); },
                'GLITCH': () => { glitchMode = !glitchMode; document.body.classList.toggle('glitch-mode'); showAchievement(" GLITCH!"); },
                'MATRIX': () => { matrixMode = !matrixMode; document.body.classList.toggle('matrix-mode'); showAchievement(" MATRIX!"); },
                'SPIRIT': () => { const s = spirits[Math.floor(Math.random() * spirits.length)]; activateSpirit(s.effect); },
                'MUTATE': () => { activateMutation(); },
                'DUAL': () => { dualMode = !dualMode; if(dualMode){snake2=[{x:15,y:15},{x:14,y:15},{x:13,y:15}];direction2={x:1,y:0};} document.getElementById('dualSnakeIndicator').classList.toggle('show', dualMode); showAchievement(dualMode?" DUAL!":" Off"); },
                'TIME': () => { timeTravel(); },
                'REALITY': () => { triggerRealityFracture(); },
                'BLESSING': () => { showBlessingPanel(); },
                'ENDGAME': () => { activateEndgame(); },
                'VIRUS': () => { toggleVirusMode(); },
                'GOD': () => { activateGodView(); },
                'COSMIC': () => { activateCosmicHorror(); },
                'NIGHTMARE': () => { activateNightmare(); },
                'TRUEEND': () => { triggerTrueEnding(); },
                'JOKER': () => { activateJokerMode(); },
                'VOID': () => { summonVoidEntity(); },
                'EXIST': () => { triggerExistentialCrisis(); },
                'FREEZE': () => { activateTimeFreeze(); },
                'ASCEND': () => { activateAscended(); },
                'WALL': () => { dimensionWall = !dimensionWall; document.getElementById('dimensionWallLeft').classList.toggle('active', dimensionWall); document.getElementById('dimensionWallRight').classList.toggle('active', dimensionWall); showAchievement(" WALL!"); },
                'MIRROR': () => { toggleMirrorDimension(); },
                'FOURTH': () => { fourthWall=true; const wall=document.getElementById('fourthWall'); wall.classList.add('show'); const phrases=["Te veo","Soy consciente","Por qu jugs?","Dale, mueve la snake"]; document.getElementById('fourthWallText').textContent=phrases[Math.floor(Math.random()*phrases.length)]; setTimeout(()=>{wall.classList.remove('show');fourthWall=false;},4000); },
                'POCKET': () => { pocketUniverse = !pocketUniverse; document.getElementById('pocketUniverse').classList.toggle('show', pocketUniverse); showAchievement(pocketUniverse ? " BOLSILLO!" : " Cerrado"); },
                'RNG': () => { rngGod = true; const rng=document.getElementById('rngGod'); rng.classList.add('show'); const vals=["42","666","999","0",""]; let i=0; const int=setInterval(()=>{document.getElementById('rngText').textContent=vals[i%vals.length];i++;if(i>10){clearInterval(int);rng.classList.remove('show');score+=parseInt(vals[(i-1)%vals.length]);updateUI();}},200); showAchievement(" RNG!"); },
                'INCEPTION': () => { inceptionDream = !inceptionDream; document.getElementById('inceptionDream').classList.toggle('show', inceptionDream); showAchievement(inceptionDream?" SUEO!":" Despertar"); },
                'TIMELOOP': () => { timeloop = !timeloop; document.getElementById('timeloop').classList.toggle('active', timeloop); showAchievement(timeloop?" TIMELOOP!":" Loop roto"); },
                'MULTIVERSE': () => { multiverseView = !multiverseView; const mv=document.getElementById('multiverseView'); mv.classList.toggle('show', multiverseView); if(multiverseView){mv.innerHTML='';for(let i=0;i<16;i++){let u=document.createElement('div');u.className='universe-instance';u.style.borderColor=['#f00','#0f0','#00f','#ff0'][i%4];mv.appendChild(u);}} showAchievement(multiverseView?" MULTIVERSO!":" Unificado"); },
                'AVATAR': () => { playerAvatar = !playerAvatar; document.getElementById('playerAvatar').classList.toggle('show', playerAvatar); showAchievement(playerAvatar?" AVATAR!":" Sin avatar"); },
                'INVENTORY': () => { inventory.push({name:'Item '+inventory.length,icon:''}); localStorage.setItem('snakeInventory',JSON.stringify(inventory)); showInventory(); showAchievement(" ITEM!"); },
                'ABILITY': () => { abilityTree = !abilityTree; document.getElementById('abilityTree').classList.toggle('show', abilityTree); showAchievement(abilityTree?" RBOL!":" Cerrado"); },
                'ECHO': () => { echoChamber = !echoChamber; document.getElementById('echoChamber').classList.toggle('show', echoChamber); if(echoChamber){setInterval(()=>{if(echoChamber){const ec=document.getElementById('echoChamber');ec.innerHTML='<div class="echo-msg">'+["Pods escucharme?","Tu score: "+score,"El vaco existe","Eres uno con la snake"][Math.floor(Math.random()*4)]+'</div>';}},2000);} showAchievement(echoChamber?" ECO!":" Silencio"); },
                'WORM': () => { voidWorm = !voidWorm; document.getElementById('voidWorm').classList.toggle('show', voidWorm); showAchievement(voidWorm?" GUSANO!":" Se fue"); },
                'CREATOR': () => { gameCreator = !gameCreator; document.getElementById('gameCreator').classList.toggle('show', gameCreator); if(gameCreator){setTimeout(()=>{document.getElementById('gameCreator').classList.remove('show');gameCreator=false;},3000);} showAchievement(gameCreator?" CREADOR!":" Creado"); },
                'ANSWER': () => { theAnswer = true; document.getElementById('theAnswer').classList.add('show'); setTimeout(()=>{document.getElementById('theAnswer').classList.remove('show');theAnswer=false;},3000); showAchievement("42"); },
                'GODTRUE': () => { godModeTrue = true; document.getElementById('godModeTrue').classList.add('show'); setTimeout(()=>{document.getElementById('godModeTrue').classList.remove('show');godModeTrue=false;},5000); showAchievement(" MODO DIOS VERDADERO!"); },
                'XP': () => { xp += 100; level = Math.floor(xp/100) + 1; showMessage("Level up! Nivel " + level); },
                'HACK': () => { realityBreaker = !realityBreaker; document.getElementById('realityBreaker').classList.toggle('active', realityBreaker); document.getElementById('realityHack').classList.toggle('active', realityBreaker); showAchievement(realityBreaker?" HACK!":" Hackeado"); },
                'NEURAL': () => { neuralNetwork = !neuralNetwork; document.getElementById('neuralNetwork').classList.toggle('active', neuralNetwork); showAchievement(neuralNetwork?" NEURAL!":" Cerebro off"); },
                'QUANTUM': () => { quantumReality = !quantumReality; document.getElementById('quantumReality').classList.toggle('active', quantumReality); showAchievement(quantumReality?" QUANTUM!":" Normal"); },
                'VOIDREACH': () => { voidReached = true; document.getElementById('voidReached').classList.add('show'); showAchievement(" ALCANZASTE EL VACO!"); },
                'SAVE': () => { saveSystem = !saveSystem; document.getElementById('saveFile').classList.toggle('show', saveSystem); showAchievement(saveSystem?" GUARDAR!":" Cerrado"); },
                'ASCEND': () => { ascensionGate = true; document.getElementById('ascensionGate').classList.add('show'); setTimeout(()=>{document.getElementById('ascensionGate').classList.remove('show');ascensionGate=false;},3000); showAchievement(" ASCENSIN!"); },
                'FINAL': () => { finalForm = true; document.getElementById('finalForm').classList.add('show'); setTimeout(()=>{document.getElementById('finalForm').classList.remove('show');finalForm=false;},4000); showAchievement(" FORMA FINAL!"); },
                'ENGINE': () => { realityEngine = !realityEngine; document.getElementById('realityEngine').classList.toggle('show', realityEngine); showAchievement(realityEngine?" ENGINE!":" Cerrado"); },
                'ZERO': () => { dimensionZero = true; document.getElementById('dimensionZero').classList.add('show'); setTimeout(()=>{document.getElementById('dimensionZero').classList.remove('show');dimensionZero=false;},5000); showAchievement("0 DIMENSIN CERO!"); },
                'ENDING': () => { endingSequence = true; const es=document.getElementById('endingSequence'); es.classList.add('show'); const texts=["GRACIAS POR JUGAR","Tu score final: "+score,"Eres uno con la snake","El vaco te espera..."]; let i=0; const int=setInterval(()=>{if(i>=texts.length){es.classList.remove('show');clearInterval(int);return;} es.innerHTML=texts.map(t=>`<div class="ending-text">${t}</div>`).join('');i++;},2000); showAchievement(" ENDING!"); },
                'NGP': () => { newgamePlus = true; ngplusLevel++; document.getElementById('newgamePlus').classList.add('show'); score = 0; combo = 1; updateUI(); setTimeout(()=>{document.getElementById('newgamePlus').classList.remove('show');newgamePlus=false;init();},3000); showAchievement(" NUEVO JUEGO+!"); },
                'GODTIER': () => { godTier = true; document.getElementById('godTier').classList.add('show'); setTimeout(()=>{document.getElementById('godTier').classList.remove('show');godTier=false;},5000); showAchievement(" DIOS VERDADERO!"); }
            };
            
            if (keyMap[code]) {
                keyMap[code]();
                playSound('achievement');
            }
        }
        
        function showInventory() {
            document.getElementById('inventoryPanel').classList.add('show');
            const list = document.getElementById('inventoryList');
            list.innerHTML = inventory.map(i => `<div class="inventory-item">${i.icon} ${i.name}</div>`).join('') || '<div style="color:#666">Vaco</div>';
        }
        
        function unlockAbility(index) {
            if (!unlockedAbilities.includes(index)) {
                unlockedAbilities.push(index);
                showAchievement(" HABILIDAD " + index + " DESBLOQUEADA!");
                playSound('achievement');
            }
        }
        
        function saveGame(slot) {
            const saveData = { score, highscore, deathCount, level, xp, inventory, unlockedAbilities, date: new Date().toISOString() };
            localStorage.setItem('snakeSave' + slot, JSON.stringify(saveData));
            showMessage("Juego guardado en ranura " + (slot+1) + "!");
            document.getElementById('saveFile').classList.remove('show');
        }
        
        function engineCreate(type) {
            if (type === 'snake') {
                const newSnake = { x: Math.floor(Math.random() * TILE_COUNT), y: Math.floor(Math.random() * TILE_COUNT) };
                enemySnakes.push({ snake: [newSnake, {x:newSnake.x-1, y:newSnake.y}, {x:newSnake.x-2, y:newSnake.y}], direction: {x:1,y:0}, length: 3 });
                showMessage("Snake creada!");
            } else if (type === 'food') {
                specialFoods.push({ x: Math.floor(Math.random() * TILE_COUNT), y: Math.floor(Math.random() * TILE_COUNT), type: 'bonus', color: '#ff0', emoji: '' });
                showMessage("Comida creada!");
            } else if (type === 'wall') {
                const wallX = Math.floor(Math.random() * TILE_COUNT);
                for (let i = 0; i < 5; i++) {
                    // Wall would need more complex implementation
                }
                showMessage("Pared creada!");
            }
        }
        
        function engineDestroy() {
            enemySnakes = [];
            specialFoods = [];
            showMessage("Todo destruido!");
        }
        
        function aiAutoPlay() {
            if (!autoPlay) return;
            
            const head = snake[0];
            const dx = food.x - head.x;
            const dy = food.y - head.y;
            
            let bestDir = { x: 0, y: 0 };
            
            if (Math.abs(dx) > Math.abs(dy)) {
                bestDir.x = dx > 0 ? 1 : -1;
                bestDir.y = 0;
            } else {
                bestDir.x = 0;
                bestDir.y = dy > 0 ? 1 : -1;
            }
            
            if (bestDir.x !== -direction.x || bestDir.y !== -direction.y) {
                nextDirection = bestDir;
            }
        }
        
        document.querySelectorAll('.shop-item').forEach(item => {
            item.addEventListener('click', () => {
                const itemName = item.dataset.item;
                const cost = parseInt(item.dataset.cost);
                buyItem(itemName, cost);
            });
        });
        
        function checkDailyChallenge() {
            const today = new Date().toDateString();
            const saved = JSON.parse(localStorage.getItem('dailyChallenge')) || {};
            
            if (saved.date !== today) {
                const challenges = [
                    { text: "Llega a 500 puntos", target: 500, type: 'score' },
                    { text: "Come 20 comidas", target: 20, type: 'food' },
                    { text: "Sobreviv 60 segundos", target: 60, type: 'time' },
                    { text: "Llega a score 1000", target: 1000, type: 'score' },
                    { text: "Come 10 poderes", target: 10, type: 'power' }
                ];
                dailyChallenge = {
                    ...challenges[Math.floor(Math.random() * challenges.length)],
                    date: today,
                    progress: 0,
                    completed: false
                };
                localStorage.setItem('dailyChallenge', JSON.stringify(dailyChallenge));
                document.getElementById('dailyChallenge').classList.add('show');
                updateDailyChallengeUI();
            } else {
                dailyChallenge = saved;
                if (!dailyChallenge.completed) {
                    document.getElementById('dailyChallenge').classList.add('show');
                    updateDailyChallengeUI();
                }
            }
        }
        
        function updateDailyChallengeUI() {
            if (dailyChallenge) {
                const el = document.getElementById('dailyChallenge');
                el.textContent = " DESAFO: " + dailyChallenge.text + " (" + dailyChallenge.progress + "/" + dailyChallenge.target + ")";
                if (dailyChallenge.completed) {
                    el.classList.add('complete');
                }
            }
        }
        
        function triggerRandomEvent() {
            const eventTypes = ['inverted', 'ghost', 'portal'];
            const type = eventTypes[Math.floor(Math.random() * eventTypes.length)];
            
            if (type === 'inverted') {
                events.inverted = true;
                showEvent(" CONTROLES INVERTIDOS!");
                setTimeout(() => { events.inverted = false; }, 8000);
            } else if (type === 'ghost') {
                events.ghost = true;
                showEvent(" MODO FANTASMA!");
                setTimeout(() => { events.ghost = false; }, 6000);
            } else if (type === 'portal') {
                spawnPortal();
                showEvent(" PORTAL DIMENSIONAL!");
            }
        }
        
        function activateDimension(effect) {
            if (effect === 'inverted') {
                events.inverted = true;
                showEvent(" DIMENSIN INVERTIDA");
                setTimeout(() => { events.inverted = false; }, 10000);
            } else if (effect === '8bit') {
                gameSpeed = 200;
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
                showEvent(" MODO 8-BIT");
                setTimeout(() => {
                    gameSpeed = 100;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(update, gameSpeed);
                }, 8000);
            } else if (effect === 'inferno') {
                if (snake.length > 3) {
                    snake.pop();
                    snake.pop();
                }
                showEvent(" INFERNO!");
            } else if (effect === 'cold') {
                gameSpeed = 200;
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
                showEvent(" FRO EXTREMO!");
                setTimeout(() => {
                    gameSpeed = 100;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(update, gameSpeed);
                }, 8000);
            }
        }
        
        function render() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawGrid();
            
            if (events.void) {
                const voidSize = events.voidLevel * 5;
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, voidSize, canvas.height);
                ctx.fillRect(canvas.width - voidSize, 0, voidSize, canvas.height);
                ctx.fillRect(0, 0, canvas.width, voidSize);
                ctx.fillRect(0, canvas.height - voidSize, canvas.width, voidSize);
            }
            
            portals.forEach(p => {
                ctx.save();
                ctx.globalAlpha = p.timer / 100;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x * GRID + GRID/2, p.y * GRID + GRID/2, GRID, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            });
            
            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            ctx.arc(food.x * GRID + GRID/2, food.y * GRID + GRID/2, GRID/2 - 2, 0, Math.PI * 2);
            ctx.fill();
            
            specialFoods.forEach(sf => {
                ctx.fillStyle = sf.color;
                ctx.beginPath();
                ctx.arc(sf.x * GRID + GRID/2, sf.y * GRID + GRID/2, GRID/2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(sf.emoji, sf.x * GRID + GRID/2, sf.y * GRID + GRID/2 + 4);
            });
            
            snake.forEach((s, i) => {
                const alpha = events.ghost || mutation === 'invisible' ? 0.4 : 1;
                let fillStyle;
                
                if (currentSkin === 'rainbow') {
                    const hue = (score + i * 10) % 360;
                    fillStyle = `hsl(${hue}, 100%, 50%)`;
                } else if (currentSkin === 'fire') {
                    const hue = 0 + (i * 5) % 60;
                    fillStyle = `hsl(${hue}, 100%, 50%)`;
                } else if (currentSkin === 'ice') {
                    fillStyle = `hsl(180, 100%, ${70 - (i * 2)}%)`;
                } else if (currentSkin === 'toxic') {
                    fillStyle = `hsl(120, 100%, ${50 - (i % 10) * 3}%)`;
                } else if (currentSkin === 'gold') {
                    fillStyle = `hsl(45, 100%, ${60 - (i % 5) * 5}%)`;
                } else if (currentSkin === 'shadow') {
                    fillStyle = `hsl(0, 0%, ${30 - (i % 5) * 5}%)`;
                } else {
                    const hue = (score + i * 10) % 360;
                    fillStyle = `hsl(${hue}, 100%, 50%)`;
                }
                
                ctx.fillStyle = fillStyle;
                ctx.globalAlpha = alpha;
                ctx.shadowColor = ctx.fillStyle;
                ctx.shadowBlur = 10;
                ctx.fillRect(s.x * GRID + 1, s.y * GRID + 1, GRID - 2, GRID - 2);
                ctx.shadowBlur = 0;
                ctx.globalAlpha = 1;
            });
            
            if (dualMode) {
                snake2.forEach((s, i) => {
                    ctx.fillStyle = `hsl(280, 100%, 50%)`;
                    ctx.globalAlpha = 0.7;
                    ctx.fillRect(s.x * GRID + 1, s.y * GRID + 1, GRID - 2, GRID - 2);
                    ctx.globalAlpha = 1;
                });
            }
            
            clones.forEach(clone => {
                clone.snake.forEach((s, i) => {
                    ctx.fillStyle = `hsla(60, 100%, 50%, 0.5)`;
                    ctx.fillRect(s.x * GRID + 1, s.y * GRID + 1, GRID - 2, GRID - 2);
                });
            });
            
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 3, 3);
                ctx.globalAlpha = 1;
                if (p.life <= 0) particles.splice(i, 1);
            });
            
            mines.forEach(m => {
                const pulse = Math.sin(Date.now() / 100) * 0.5 + 0.5;
                ctx.fillStyle = `rgba(255, 0, 0, ${pulse})`;
                ctx.beginPath();
                ctx.arc(m.x * GRID + GRID/2, m.y * GRID + GRID/2, GRID/2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('', m.x * GRID + GRID/2, m.y * GRID + GRID/2 + 4);
            });
            
            if (showMinimap) updateMinimap();
            
            if (score >= 7777) {
                ctx.fillStyle = '#f0f';
                ctx.font = '12px "Press Start 2P"';
                ctx.textAlign = 'center';
                ctx.fillText('MODO DIOS', canvas.width/2, canvas.height/2);
            }
        }
        
        function drawGrid() {
            ctx.strokeStyle = 'rgba(0,255,255,0.05)';
            ctx.lineWidth = 1;
            for (let i = 0; i < TILE_COUNT; i++) {
                ctx.beginPath();
                ctx.moveTo(i * GRID, 0);
                ctx.lineTo(i * GRID, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * GRID);
                ctx.lineTo(canvas.width, i * GRID);
                ctx.stroke();
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('combo').textContent = combo;
            if (score > highscore) {
                highscore = score;
                localStorage.setItem('snakeHighscore', highscore);
                document.getElementById('highscore').textContent = highscore;
            }
        }
        
        function updatePowerUI() {
            document.getElementById('powerInvincible').classList.toggle('active', powers.invincible.active);
            document.getElementById('powerX2').classList.toggle('active', powers.x2.active);
            document.getElementById('powerSlow').classList.toggle('active', powers.slow.active);
            document.getElementById('powerShort').classList.toggle('active', powers.short.active);
            document.getElementById('powerInverted').classList.toggle('active', events.inverted);
            document.getElementById('powerGhost').classList.toggle('active', events.ghost);
        }
        
        function showEvent(text) {
            const display = document.getElementById('eventDisplay');
            display.textContent = text;
            display.classList.add('show');
            setTimeout(() => display.classList.remove('show'), 2000);
        }
        
        function showMessage(text) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 3000);
        }
        
        function showAchievement(text) {
            const ach = document.getElementById('achievement');
            ach.textContent = text;
            ach.classList.add('show');
            playSound('achievement');
            setTimeout(() => ach.classList.remove('show'), 3000);
        }
        
        function checkAchievements() {
            if (!achievements.firstBlood.unlocked && score >= 10) {
                achievements.firstBlood.unlocked = true;
                showAchievement(" Primera Sangre!");
            }
            if (!achievements.combo5.unlocked && combo >= 5) {
                achievements.combo5.unlocked = true;
                showAchievement(" Combo x5!");
            }
            if (!achievements.voidEscape.unlocked && score >= 2000) {
                achievements.voidEscape.unlocked = true;
                showAchievement(" Escap del Vaco!");
            }
            if (!achievements.godMode.unlocked && score >= 7777) {
                achievements.godMode.unlocked = true;
                showAchievement(" MODO DIOS!");
            }
        }
        
        function gameOver() {
            isGameOver = true;
            clearInterval(gameLoop);
            canvas.classList.add('shake');
            setTimeout(() => canvas.classList.remove('shake'), 300);
            playSound('die');
            
            deathCount++;
            localStorage.setItem('snakeDeaths', deathCount);
            
            totalPlayTime += Math.floor((Date.now() - playSessionStart) / 1000);
            localStorage.setItem('snakePlayTime', totalPlayTime);
            
            const entry = {
                date: new Date().toLocaleDateString(),
                score: score,
                reason: events.void ? "El Vaco" : "Chocaste",
                deaths: deathCount
            };
            diary.unshift(entry);
            if (diary.length > 50) diary.pop();
            localStorage.setItem('snakeDiary', JSON.stringify(diary));
            
            if (lives > 1) {
                lives--;
                document.getElementById('lives').textContent = "".repeat(lives);
                showMessage("Perdiste una vida! Restantes: " + lives);
                setTimeout(() => init(), 1500);
                return;
            }
            
            if (!achievements.diary.unlocked) {
                achievements.diary.unlocked = true;
                showAchievement(" Escribiste en el diario!");
            }
            
            const philosophy = [
                "\"La snake muere, pero el vaco permanece\"",
                "\"Morir es solo un restart ms largo\"",
                "\"Real mors o es la snake?\"",
                "\"El score no define tu existencia\"",
                "\"La prxima vida ser mejor\"",
                "\"Eran 8 bits de sufrimiento\"",
                "\"El vaco te espera con los brazos abiertos\"",
                "\"Solo css y js, nada es real\""
            ];
            
            const choice = confirm("Realmente quers continuar?\n\nTu score: " + score + "\n\nTotal de muertes: " + deathCount);
            if (choice) {
                lives = 1;
                document.getElementById('lives').textContent = "";
                init();
            } else {
                const msg = philosophy[Math.floor(Math.random() * philosophy.length)];
                showMessage(msg);
                setTimeout(() => {
                    alert("La snake dice: \"" + msg + "\"\n\n" + "Muriste " + deathCount + " veces.\nTiempo total: " + totalPlayTime + " segundos");
                    const randomTip = gameDiaryTips[Math.floor(Math.random() * gameDiaryTips.length)];
                    alert("Del diario: " + randomTip);
                }, 500);
            }
        }
        
        document.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                if (isGameOver || isPaused) {
                    init();
                    isPaused = false;
                }
                return;
            }
            
            if (e.key === 'Escape') {
                escapeClicks++;
                if (escapeClicks >= 10 && !achievements.escape.unlocked) {
                    achievements.escape.unlocked = true;
                    showAchievement(" Encontraste la SALIDA!");
                    showMessage("Buscaste la salida 10 veces...");
                    setTimeout(() => {
                        window.open('https://www.google.com/search?q=libertad', '_blank');
                    }, 1000);
                    escapeClicks = 0;
                } else if (escapeClicks < 10) {
                    showMessage("Clicks de escape: " + escapeClicks + "/10");
                }
                return;
            }
            
            if (e.key === 'p' || e.key === 'P') {
                isPaused = !isPaused;
                showMessage(isPaused ? "PAUSA" : "CONTINU");
                return;
            }
            
            if (e.key === KONAMI[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === KONAMI.length) {
                    lives = 99;
                    powers.invincible.active = false;
                    document.getElementById('lives').textContent = "".repeat(99);
                    showAchievement(" KONAMI! VIDAS INFINITAS!");
                    if (!achievements.konamiCode.unlocked) {
                        achievements.konamiCode.unlocked = true;
                    }
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
            
            if (e.key === ABRACADABRA[0] || rainbowMode) {
                constabraIndex = (e.key === ABRACADABRA[0]) ? 1 : 0;
                for (let i = 0; i < ABRACADABRA.length; i++) {
                    if (e.key === ABRACADABRA[i]) {
                        rainbowMode = true;
                        document.body.classList.add('rainbow-mode');
                        showAchievement(" MODO ARCORIS!");
                        break;
                    }
                }
            }
            
            if (e.key === CHAOS[chaosIndex]) {
                chaosIndex++;
                if (chaosIndex === CHAOS.length) {
                    chaosMode = !chaosMode;
                    document.body.classList.toggle('chaos-mode');
                    showAchievement(chaosMode ? " MODO CAOS!" : " CAOS DESACTIVADO");
                    chaosIndex = 0;
                    playSound('boss');
                }
            } else {
                chaosIndex = 0;
            }
            
            if (e.key === METEOR[meteorIndex]) {
                meteorIndex++;
                if (meteorIndex === METEOR.length) {
                    showEvent(" LLUVIA DE METEORITOS!");
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => spawnMeteor(), i * 500);
                    }
                    meteorIndex = 0;
                }
            } else {
                meteorIndex = 0;
            }
            
            if (e.key === GLITCH[glitchIndex]) {
                glitchIndex++;
                if (glitchIndex === GLITCH.length) {
                    glitchMode = !glitchMode;
                    document.body.classList.toggle('glitch-mode');
                    showAchievement(glitchMode ? " MODO GLITCH!" : " GLITCH DESACTIVADO");
                    glitchIndex = 0;
                    playSound('boss');
                }
            } else {
                glitchIndex = 0;
            }
            
            if (e.key === MINIMAP[minimapIndex]) {
                minimapIndex++;
                if (minimapIndex === MINIMAP.length) {
                    showMinimap = !showMinimap;
                    document.getElementById('minimap').classList.toggle('show', showMinimap);
                    showMessage(showMinimap ? " Minimapa activado" : " Minimapa desactivado");
                    minimapIndex = 0;
                }
            } else {
                minimapIndex = 0;
            }
            
            if (e.key === SPIRIT[spiritIndex]) {
                spiritIndex++;
                if (spiritIndex === SPIRIT.length) {
                    const randomSpirit = spirits[Math.floor(Math.random() * spirits.length)];
                    activateSpirit(randomSpirit.effect);
                    spiritIndex = 0;
                }
            } else {
                spiritIndex = 0;
            }
            
            if (e.key === MATRIX[matrixIndex]) {
                matrixIndex++;
                if (matrixIndex === MATRIX.length) {
                    matrixMode = !matrixMode;
                    document.body.classList.toggle('matrix-mode', matrixMode);
                    showAchievement(matrixMode ? " MATRIX MODE!" : " Sali de Matrix");
                    matrixIndex = 0;
                    playSound('achievement');
                }
            } else {
                matrixIndex = 0;
            }
            
            if (e.key === SHOP[shopIndex]) {
                shopIndex++;
                if (shopIndex === SHOP.length) {
                    shopOpen = !shopOpen;
                    document.getElementById('shopPanel').classList.toggle('show', shopOpen);
                    showMessage(shopOpen ? " Tienda abierta" : " Tienda cerrada");
                    shopIndex = 0;
                }
            } else {
                shopIndex = 0;
            }
            
            if (e.key === MUTATE[mutateIndex]) {
                mutateIndex++;
                if (mutateIndex === MUTATE.length) {
                    activateMutation();
                    mutateIndex = 0;
                }
            } else {
                mutateIndex = 0;
            }
            
            if (e.key === DUAL[dualIndex]) {
                dualIndex++;
                if (dualIndex === DUAL.length) {
                    dualMode = !dualMode;
                    if (dualMode) {
                        snake2 = [
                            { x: 15, y: 15 },
                            { x: 14, y: 15 },
                            { x: 13, y: 15 }
                        ];
                        direction2 = { x: 1, y: 0 };
                    }
                    document.getElementById('dualSnakeIndicator').classList.toggle('show', dualMode);
                    showAchievement(dualMode ? " MODO DUAL!" : " Modo dual desactivado");
                    dualIndex = 0;
                    playSound('achievement');
                }
            } else {
                dualIndex = 0;
            }
            
            if (e.key === TIME[timeIndex]) {
                timeIndex++;
                if (timeIndex === TIME.length) {
                    timeTravel();
                    timeIndex = 0;
                }
            } else {
                timeIndex = 0;
            }
            
            if (e.key === REALITY[realityIndex]) {
                realityIndex++;
                if (realityIndex === REALITY.length) {
                    triggerRealityFracture();
                    realityIndex = 0;
                }
            } else {
                realityIndex = 0;
            }
            
            if (e.key === BLESSING[blessingIndex]) {
                blessingIndex++;
                if (blessingIndex === BLESSING.length) {
                    showBlessingPanel();
                    blessingIndex = 0;
                }
            } else {
                blessingIndex = 0;
            }
            
            if (e.key === INCEPTION[inceptionIndex]) {
                inceptionIndex++;
                if (inceptionIndex === INCEPTION.length) {
                    activateInception();
                    inceptionIndex = 0;
                }
            } else {
                inceptionIndex = 0;
            }
            
            if (e.key === CLONE[cloneIndex]) {
                cloneIndex++;
                if (cloneIndex === CLONE.length) {
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => spawnClone(), i * 200);
                    }
                    showAchievement(" EJRCITO DE CLONES!");
                    cloneIndex = 0;
                }
            } else {
                cloneIndex = 0;
            }
            
            if (e.key === ENDGAME[endgameIndex]) {
                endgameIndex++;
                if (endgameIndex === ENDGAME.length) {
                    activateEndgame();
                    endgameIndex = 0;
                }
            } else {
                endgameIndex = 0;
            }
            
            if (e.key === LIQUID[liquidIndex]) {
                liquidIndex++;
                if (liquidIndex === LIQUID.length) {
                    toggleLiquidMode();
                    liquidIndex = 0;
                }
            } else {
                liquidIndex = 0;
            }
            
            if (e.key === VIRUS[virusIndex]) {
                virusIndex++;
                if (virusIndex === VIRUS.length) {
                    toggleVirusMode();
                    virusIndex = 0;
                }
            } else {
                virusIndex = 0;
            }
            
            if (e.key === AUTOPLAY[autoplayIndex]) {
                autoplayIndex++;
                if (autoplayIndex === AUTOPLAY.length) {
                    toggleAutoPlay();
                    autoplayIndex = 0;
                }
            } else {
                autoplayIndex = 0;
            }
            
            if (e.key === MIRROR[mirrorIndex]) {
                mirrorIndex++;
                if (mirrorIndex === MIRROR.length) {
                    toggleMirrorDimension();
                    mirrorIndex = 0;
                }
            } else {
                mirrorIndex = 0;
            }
            
            if (e.key === QUANTUM[quantumIndex]) {
                quantumIndex++;
                if (quantumIndex === QUANTUM.length) {
                    activateQuantum();
                    quantumIndex = 0;
                }
            } else {
                quantumIndex = 0;
            }
            
            if (e.key === GRAVITY[gravityIndex]) {
                gravityIndex++;
                if (gravityIndex === GRAVITY.length) {
                    spawnGravityZone();
                    gravityIndex = 0;
                }
            } else {
                gravityIndex = 0;
            }
            
            if (e.key === FOOD[foodIndex]) {
                foodIndex++;
                if (foodIndex === FOOD.length) {
                    activateFoodMode();
                    foodIndex = 0;
                }
            } else {
                foodIndex = 0;
            }
            
            if (e.key === EVOLVE[evolveIndex]) {
                evolveIndex++;
                if (evolveIndex === EVOLVE.length) {
                    activateEvolution();
                    evolveIndex = 0;
                }
            } else {
                evolveIndex = 0;
            }
            
            if (e.key === GOD[godIndex]) {
                godIndex++;
                if (godIndex === GOD.length) {
                    activateGodView();
                    godIndex = 0;
                }
            } else {
                godIndex = 0;
            }
            
            if (e.key === STICKER[stickerIndex]) {
                stickerIndex++;
                if (stickerIndex === STICKER.length) {
                    spawnSticker();
                    spawnSticker();
                    spawnSticker();
                    showAchievement(" STICKERS!");
                    stickerIndex = 0;
                }
            } else = 0;
 {
                stickerIndex            }
            
            if (e.key === TUNNEL[tunnelIndex]) {
                tunnelIndex++;
                if (tunnelIndex === TUNNEL.length) {
                    activateTunnel();
                    tunnelIndex = 0;
                }
            } else {
                tunnelIndex = 0;
            }
            
            if (e.key === DREAM[dreamIndex]) {
                dreamIndex++;
                if (dreamIndex === DREAM.length) {
                    activateDreamMode();
                    dreamIndex = 0;
                }
            } else {
                dreamIndex = 0;
            }
            
            if (e.key === PIXEL[pixelIndex]) {
                pixelIndex++;
                if (pixelIndex === PIXEL.length) {
                    activatePixelStorm();
                    pixelIndex = 0;
                }
            } else {
                pixelIndex = 0;
            }
            
            if (e.key === HACKER[hackerIndex]) {
                hackerIndex++;
                if (hackerIndex === HACKER.length) {
                    activateHackerMode();
                    hackerIndex = 0;
                }
            } else {
                hackerIndex = 0;
            }
            
            if (e.key === JOKER[jokerIndex]) {
                jokerIndex++;
                if (jokerIndex === JOKER.length) {
                    activateJokerMode();
                    jokerIndex = 0;
                }
            } else {
                jokerIndex = 0;
            }
            
            if (e.key === CHAT[chatIndex]) {
                chatIndex++;
                if (chatIndex === CHAT.length) {
                    toggleChat();
                    chatIndex = 0;
                }
            } else {
                chatIndex = 0;
            }
            
            if (e.key === BLOOD[bloodIndex]) {
                bloodIndex++;
                if (bloodIndex === BLOOD.length) {
                    activateBloodMoon();
                    bloodIndex = 0;
                }
            } else {
                bloodIndex = 0;
            }
            
            if (e.key === VOID[voidIndex]) {
                voidIndex++;
                if (voidIndex === VOID.length) {
                    summonVoidEntity();
                    voidIndex = 0;
                }
            } else {
                voidIndex = 0;
            }
            
            if (e.key === RANDOM[randomIndex]) {
                randomIndex++;
                if (randomIndex === RANDOM.length) {
                    activateRandomizer();
                    randomIndex = 0;
                }
            } else {
                randomIndex = 0;
            }
            
            if (e.key === RIFT[riftIndex]) {
                riftIndex++;
                if (riftIndex === RIFT.length) {
                    activateDimensionRift();
                    riftIndex = 0;
                }
            } else {
                riftIndex = 0;
            }
            
            if (e.key === PARADOX[paradoxIndex]) {
                paradoxIndex++;
                if (paradoxIndex === PARADOX.length) {
                    activateParadox();
                    paradoxIndex = 0;
                }
            } else {
                paradoxIndex = 0;
            }
            
            if (e.key === NIGHTMARE[nightmareIndex]) {
                nightmareIndex++;
                if (nightmareIndex === NIGHTMARE.length) {
                    activateNightmare();
                    nightmareIndex = 0;
                }
            } else {
                nightmareIndex = 0;
            }
            
            if (e.key === TRUEEND[trueendIndex]) {
                trueendIndex++;
                if (trueendIndex === TRUEEND.length) {
                    triggerTrueEnding();
                    trueendIndex = 0;
                }
            } else {
                trueendIndex = 0;
            }
            
            if (e.key === WISPER[wisperIndex]) {
                wisperIndex++;
                if (wisperIndex === WISPER.length) {
                    whisper();
                    wisperIndex = 0;
                }
            } else {
                wisperIndex = 0;
            }
            
            if (e.key === OMNI[omniIndex]) {
                omniIndex++;
                if (omniIndex === OMNI.length) {
                    activateOmnipresent();
                    omniIndex = 0;
                }
            } else {
                omniIndex = 0;
            }
            
            if (e.key === FREEZE[freezeIndex]) {
                freezeIndex++;
                if (freezeIndex === FREEZE.length) {
                    activateTimeFreeze();
                    freezeIndex = 0;
                }
            } else {
                freezeIndex = 0;
            }
            
            if (e.key === EXIST[existIndex]) {
                existIndex++;
                if (existIndex === EXIST.length) {
                    triggerExistentialCrisis();
                    existIndex = 0;
                }
            } else {
                existIndex = 0;
            }
            
            if (e.key === COSMIC[cosmicIndex]) {
                cosmicIndex++;
                if (cosmicIndex === COSMIC.length) {
                    activateCosmicHorror();
                    cosmicIndex = 0;
                }
            } else {
                cosmicIndex = 0;
            }
            
            if (e.key === ASCEND[ascendIndex]) {
                ascendIndex++;
                if (ascendIndex === ASCEND.length) {
                    activateAscended();
                    ascendIndex = 0;
                }
            } else {
                ascendIndex = 0;
            }
            
            if (e.key === INFINITE[infiniteIndex]) {
                infiniteIndex++;
                if (infiniteIndex === INFINITE.length) {
                    activateInfiniteGame();
                    infiniteIndex = 0;
                }
            } else {
                infiniteIndex = 0;
            }
            
            if (e.key === DELETE[deleteIndex]) {
                deleteIndex++;
                if (deleteIndex === DELETE.length) {
                    activateDeleteSelf();
                    deleteIndex = 0;
                }
            } else {
                deleteIndex = 0;
            }
            
            if (e.key === MEMORY[memoryIndex]) {
                memoryIndex++;
                if (memoryIndex === MEMORY.length) {
                    showMemories();
                    memoryIndex = 0;
                }
            } else {
                memoryIndex = 0;
            }
            
            if (e.key === TUTORIAL[tutorialIndex]) {
                tutorialIndex++;
                if (tutorialIndex === TUTORIAL.length) {
                    showTutorial();
                    tutorialIndex = 0;
                }
            } else {
                tutorialIndex = 0;
            }
            
            if (e.key === WALL[wallIndex]) {
                wallIndex++;
                if (wallIndex === WALL.length) {
                    dimensionWall = !dimensionWall;
                    document.getElementById('dimensionWallLeft').classList.toggle('active', dimensionWall);
                    document.getElementById('dimensionWallRight').classList.toggle('active', dimensionWall);
                    showAchievement(dimensionWall ? " MUNDO ENCAJADO!" : " Muro destruido");
                    wallIndex = 0;
                }
            } else {
                wallIndex = 0;
            }
            
            if (e.key === GODMODE[godmodeIndex]) {
                godmodeIndex++;
                if (godmodeIndex === GODMODE.length) {
                    playAsGod = !playAsGod;
                    document.getElementById('playGod').classList.toggle('show', playAsGod);
                    showAchievement(playAsGod ? " JUGS COMO DIOS!" : " Dejaste de ser Dios");
                    godmodeIndex = 0;
                }
            } else {
                godmodeIndex = 0;
            }
            
            if (e.key === REWIND[rewindIndex]) {
                rewindIndex++;
                if (rewindIndex === REWIND.length) {
                    rewindMode = !rewindMode;
                    document.getElementById('rewindEffect').classList.toggle('active', rewindMode);
                    if (rewindMode) {
                        score = Math.max(0, score - 500);
                        updateUI();
                    }
                    showAchievement(rewindMode ? " REWIND!" : " Rewind terminado");
                    rewindIndex = 0;
                }
            } else {
                rewindIndex = 0;
            }
            
            if (e.key === MIRROR2[mirror2Index]) {
                mirror2Index++;
                if (mirror2Index === MIRROR2.length) {
                    mirrorWorld = !mirrorWorld;
                    document.getElementById('mirrorWorld').classList.toggle('show', mirrorWorld);
                    showAchievement(mirrorWorld ? " MUNDO ESPEJO!" : " Espejo roto");
                    mirror2Index = 0;
                }
            } else {
                mirror2Index = 0;
            }
            
            if (e.key === BREAK[breakIndex]) {
                breakIndex++;
                if (breakIndex === BREAK.length) {
                    realityBreaker = !realityBreaker;
                    document.getElementById('realityBreaker').classList.toggle('active', realityBreaker);
                    showAchievement(realityBreaker ? " ROMPISTE LA REALIDAD!" : " Realidad reparada");
                    breakIndex = 0;
                }
            } else {
                breakIndex = 0;
            }
            
            if (e.key === STORM[stormIndex]) {
                stormIndex++;
                if (stormIndex === STORM.length) {
                    portalStorm = !portalStorm;
                    document.getElementById('portalStorm').classList.toggle('active', portalStorm);
                    showAchievement(portalStorm ? " TORMENTA DE PORTALES!" : " Tormenta calmada");
                    stormIndex = 0;
                }
            } else {
                stormIndex = 0;
            }
            
            if (e.key === EVOLVE2[evolve2Index]) {
                evolve2Index++;
                if (evolve2Index === EVOLVE2.length) {
                    gameEvolution++;
                    const evoPanel = document.getElementById('gameEvolution');
                    evoPanel.classList.add('show');
                    evoPanel.innerHTML = ` EVOLUCIN: ${gameEvolution}/10`;
                    showAchievement(" EVOLUCION! (nivel " + gameEvolution + ")");
                    evolve2Index = 0;
                }
            } else {
                evolve2Index = 0;
            }
            
            if (e.key === RUSH[rushIndex]) {
                rushIndex++;
                if (rushIndex === RUSH.length) {
                    bossRushMode = !bossRushMode;
                    document.getElementById('bossRush').classList.toggle('show', bossRushMode);
                    if (bossRushMode) {
                        bossRushWave = 1;
                        bossRushHealth = 100;
                    }
                    showAchievement(bossRushMode ? " BOSS RUSH!" : " Boss rush terminado");
                    rushIndex = 0;
                }
            } else {
                rushIndex = 0;
            }
            
            if (e.key === MULTI[multiIndex]) {
                multiIndex++;
                if (multiIndex === MULTI.length) {
                    multiDimension = !multiDimension;
                    document.getElementById('multiDimension').style.display = multiDimension ? 'block' : 'none';
                    showAchievement(multiDimension ? " MULTIDIMENSIONAL!" : " Dimensiones unificadas");
                    multiIndex = 0;
                }
            } else {
                multiIndex = 0;
            }
            
            if (e.key === WAR[warIndex]) {
                warIndex++;
                if (warIndex === WAR.length) {
                    gameWar = !gameWar;
                    document.getElementById('gameWar').classList.toggle('show', gameWar);
                    if (gameWar) {
                        warTimer = 60;
                        const warInt = setInterval(() => {
                            warTimer--;
                            document.getElementById('warTimer').textContent = warTimer;
                            if (warTimer <= 0 || !gameWar) {
                                clearInterval(warInt);
                                gameWar = false;
                                document.getElementById('gameWar').classList.remove('show');
                            }
                        }, 1000);
                    }
                    showAchievement(gameWar ? " MODO GUERRA!" : " Guerra terminada");
                    warIndex = 0;
                }
            } else {
                warIndex = 0;
            }
            
            if (e.key === MERGE[mergeIndex]) {
                mergeIndex++;
                if (mergeIndex === MERGE.length) {
                    dimensionMerge = !dimensionMerge;
                    document.getElementById('dimensionMerge').classList.toggle('active', dimensionMerge);
                    showAchievement(dimensionMerge ? " DIMENSIONES MEZCLADAS!" : " Dimensiones separadas");
                    mergeIndex = 0;
                }
            } else {
                mergeIndex = 0;
            }
            
            if (e.key === YINYANG[yinyangIndex]) {
                yinyangIndex++;
                if (yinyangIndex === YINYANG.length) {
                    yinYang = !yinYang;
                    document.getElementById('yinyang').classList.toggle('active', yinYang);
                    showAchievement(yinYang ? " YIN YANG!" : " Equilibrio restaurado");
                    yinyangIndex = 0;
                }
            } else {
                yinyangIndex = 0;
            }
            
            if (e.key === FOURTH[fourthIndex]) {
                fourthIndex++;
                if (fourthIndex === FOURTH.length) {
                    fourthWall = !fourthWall;
                    const wall = document.getElementById('fourthWall');
                    wall.classList.toggle('show', fourthWall);
                    if (fourthWall) {
                        const phrases = [
                            "S que ests mirando la pantalla",
                            "Tu mouse est en la esquina",
                            "Llevo 1000 lneas de cdigo",
                            "No sos el jugador, sos el juego",
                            "La snake te observa",
                            "Yo tambin juego interno",
                            "Mi puntuacin real es tu aburrimiento"
                        ];
                        document.getElementById('fourthWallText').textContent = phrases[Math.floor(Math.random() * phrases.length)];
                        setTimeout(() => {
                            wall.classList.remove('show');
                            fourthWall = false;
                        }, 4000);
                    }
                    fourthIndex = 0;
                }
            } else {
                fourthIndex = 0;
            }
            
            if (e.key === GHOST[ghostIndex]) {
                ghostIndex++;
                if (ghostIndex === GHOST.length) {
                    ghostRacer = !ghostRacer;
                    document.getElementById('ghostRacer').classList.toggle('show', ghostRacer);
                    if (ghostRacer) {
                        ghostScore = 0;
                        setInterval(() => {
                            if (ghostRacer) {
                                ghostScore += Math.floor(Math.random() * 5);
                                document.getElementById('ghostScore').textContent = ghostScore;
                            }
                        }, 500);
                    }
                    showAchievement(ghostRacer ? " CARRERA FANTASMA!" : " Fantasma derrotado");
                    ghostIndex = 0;
                }
            } else {
                ghostIndex = 0;
            }
            
            if (e.key === ENEMY[enemyIndex]) {
                enemyIndex++;
                if (enemyIndex === ENEMY.length) {
                    const enemy = {
                        x: Math.floor(Math.random() * TILE_COUNT),
                        y: Math.floor(Math.random() * TILE_COUNT),
                        direction: { x: 1, y: 0 },
                        length: 5
                    };
                    enemySnakes.push(enemy);
                    showAchievement(" ENEMIGO APARECI!");
                    enemyIndex = 0;
                }
            } else {
                enemyIndex = 0;
            }
            
            const keyMap = {
                'ArrowUp': { x: 0, y: -1 },
                'ArrowDown': { x: 0, y: 1 },
                'ArrowLeft': { x: -1, y: 0 },
                'ArrowRight': { x: 1, y: 0 },
                'w': { x: 0, y: -1 },
                's': { x: 0, y: 1 },
                'a': { x: -1, y: 0 },
                'd': { x: 1, y: 0 },
                'q': spirit === 'crab' ? { x: -1, y: -1 } : null,
                'e': spirit === 'crab' ? { x: 1, y: -1 } : null,
                'z': spirit === 'crab' ? { x: -1, y: 1 } : null,
                'c': spirit === 'crab' ? { x: 1, y: 1 } : null
            };
            
            let validKey = keyMap[e.key];
            if (spirit === 'crab' && !validKey) {
                validKey = null;
            }
            
            const newDir = validKey;
            if (newDir) {
                if (newDir.x !== -direction.x || newDir.y !== -direction.y) {
                    nextDirection = newDir;
                }
                e.preventDefault();
            }
            
            if (dualMode) {
                const keyMap2 = {
                    'W': { x: 0, y: -1 },
                    'S': { x: 0, y: 1 },
                    'A': { x: -1, y: 0 },
                    'D': { x: 1, y: 0 }
                };
                const newDir2 = keyMap2[e.key];
                if (newDir2) {
                    if (newDir2.x !== -direction2.x || newDir2.y !== -direction2.y) {
                        direction2 = newDir2;
                    }
                    e.preventDefault();
                }
            }
        });
        
        canvas.addEventListener('click', (e) => {
            if (!foodMode) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / GRID);
            const y = Math.floor((e.clientY - rect.top) / GRID);
            
            if (x >= 0 && x < TILE_COUNT && y >= 0 && y < TILE_COUNT) {
                food.x = x;
                food.y = y;
                createParticles(x, y, '#ff0', 5);
            }
        });
        
        init();
    </script>
</body>
</html>
